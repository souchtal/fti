\hypertarget{failure-injection_8h}{}\doxysection{/home/bscuser/\+Documents/release/dev/fti/src/failure-\/injection.h File Reference}
\label{failure-injection_8h}\index{/home/bscuser/Documents/release/dev/fti/src/failure-\/injection.h@{/home/bscuser/Documents/release/dev/fti/src/failure-\/injection.h}}


Defines wrapper for P\+O\+S\+IX write functions to enable failure injection.  


{\ttfamily \#include $<$fti.\+h$>$}\newline
{\ttfamily \#include $<$unistd.\+h$>$}\newline
{\ttfamily \#include $<$sys/types.\+h$>$}\newline
{\ttfamily \#include $<$sys/stat.\+h$>$}\newline
{\ttfamily \#include $<$fcntl.\+h$>$}\newline
{\ttfamily \#include $<$stdint.\+h$>$}\newline
{\ttfamily \#include $<$limits.\+h$>$}\newline
Include dependency graph for failure-\/injection.h\+:
% FIG 0
This graph shows which files directly or indirectly include this file\+:
% FIG 1
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{failure-injection_8h_a7becf28120a1bfa4143d26b2b96e60a2}{F\+T\+I\+\_\+\+F\+I\+\_\+\+W\+R\+I\+TE}}(E\+RR,  FD,  B\+UF,  C\+O\+U\+NT,  FN)~( E\+RR = write( FD, B\+UF, C\+O\+U\+NT ) )
\item 
\#define \mbox{\hyperlink{failure-injection_8h_a607620c0311a5e8e774bc7ab80859084}{F\+T\+I\+\_\+\+F\+I\+\_\+\+F\+W\+R\+I\+TE}}(E\+RR,  B\+UF,  S\+I\+ZE,  C\+O\+U\+NT,  F\+S\+T\+R\+E\+AM,  FN)~( E\+RR = fwrite( B\+UF, S\+I\+ZE, C\+O\+U\+NT, F\+S\+T\+R\+E\+AM ) )
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{failure-injection_8h_a7acbcfc49eb071c72fcd452dbf00c197}{F\+T\+I\+\_\+\+Init\+F\+I\+IO}} ()
\item 
float \mbox{\hyperlink{failure-injection_8h_a42d6575e31a765c4780cba60cb923c91}{P\+R\+O\+B\+A\+B\+I\+L\+I\+TY}} ()
\item 
unsigned int \mbox{\hyperlink{failure-injection_8h_a0917c864ec34200ecfbb1dd974658547}{F\+U\+N\+C\+T\+I\+ON}} (const char $\ast$test\+Function)
\item 
int \mbox{\hyperlink{failure-injection_8h_a791fd93b18d6c214cef5d6b934dcbd55}{F\+T\+I\+\_\+\+Float\+Bit\+Flip}} (float $\ast$target, int bit)
\begin{DoxyCompactList}\small\item\em It corrupts a bit of the given float. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{failure-injection_8h_acd287cd3e5911bb2d8266c0d8219c861}{F\+T\+I\+\_\+\+Double\+Bit\+Flip}} (double $\ast$target, int bit)
\begin{DoxyCompactList}\small\item\em It corrupts a bit of the given float. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Defines wrapper for P\+O\+S\+IX write functions to enable failure injection. 

Copyright (c) 2017 Leonardo A. Bautista-\/\+Gomez All rights reserved

F\+TI -\/ A multi-\/level checkpointing library for C/\+C++/\+Fortran applications

Revision 1.\+0 \+: Fault Tolerance Interface (F\+TI)

Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met\+:


\begin{DoxyEnumerate}
\item Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
\item Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
\item Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.
\end{DoxyEnumerate}

T\+H\+IS S\+O\+F\+T\+W\+A\+RE IS P\+R\+O\+V\+I\+D\+ED BY T\+HE C\+O\+P\+Y\+R\+I\+G\+HT H\+O\+L\+D\+E\+RS A\+ND C\+O\+N\+T\+R\+I\+B\+U\+T\+O\+RS \char`\"{}\+A\+S I\+S\char`\"{} A\+ND A\+NY E\+X\+P\+R\+E\+SS OR I\+M\+P\+L\+I\+ED W\+A\+R\+R\+A\+N\+T\+I\+ES, I\+N\+C\+L\+U\+D\+I\+NG, B\+UT N\+OT L\+I\+M\+I\+T\+ED TO, T\+HE I\+M\+P\+L\+I\+ED W\+A\+R\+R\+A\+N\+T\+I\+ES OF M\+E\+R\+C\+H\+A\+N\+T\+A\+B\+I\+L\+I\+TY A\+ND F\+I\+T\+N\+E\+SS F\+OR A P\+A\+R\+T\+I\+C\+U\+L\+AR P\+U\+R\+P\+O\+SE A\+RE D\+I\+S\+C\+L\+A\+I\+M\+ED. IN NO E\+V\+E\+NT S\+H\+A\+LL T\+HE C\+O\+P\+Y\+R\+I\+G\+HT H\+O\+L\+D\+ER OR C\+O\+N\+T\+R\+I\+B\+U\+T\+O\+RS BE L\+I\+A\+B\+LE F\+OR A\+NY D\+I\+R\+E\+CT, I\+N\+D\+I\+R\+E\+CT, I\+N\+C\+I\+D\+E\+N\+T\+AL, S\+P\+E\+C\+I\+AL, E\+X\+E\+M\+P\+L\+A\+RY, OR C\+O\+N\+S\+E\+Q\+U\+E\+N\+T\+I\+AL D\+A\+M\+A\+G\+ES (I\+N\+C\+L\+U\+D\+I\+NG, B\+UT N\+OT L\+I\+M\+I\+T\+ED TO, P\+R\+O\+C\+U\+R\+E\+M\+E\+NT OF S\+U\+B\+S\+T\+I\+T\+U\+TE G\+O\+O\+DS OR S\+E\+R\+V\+I\+C\+ES; L\+O\+SS OF U\+SE, D\+A\+TA, OR P\+R\+O\+F\+I\+TS; OR B\+U\+S\+I\+N\+E\+SS I\+N\+T\+E\+R\+R\+U\+P\+T\+I\+ON) H\+O\+W\+E\+V\+ER C\+A\+U\+S\+ED A\+ND ON A\+NY T\+H\+E\+O\+RY OF L\+I\+A\+B\+I\+L\+I\+TY, W\+H\+E\+T\+H\+ER IN C\+O\+N\+T\+R\+A\+CT, S\+T\+R\+I\+CT L\+I\+A\+B\+I\+L\+I\+TY, OR T\+O\+RT (I\+N\+C\+L\+U\+D\+I\+NG N\+E\+G\+L\+I\+G\+E\+N\+CE OR O\+T\+H\+E\+R\+W\+I\+SE) A\+R\+I\+S\+I\+NG IN A\+NY W\+AY O\+UT OF T\+HE U\+SE OF T\+H\+IS S\+O\+F\+T\+W\+A\+RE, E\+V\+EN IF A\+D\+V\+I\+S\+ED OF T\+HE P\+O\+S\+S\+I\+B\+I\+L\+I\+TY OF S\+U\+CH D\+A\+M\+A\+GE.

In order ro enable the Failure Injection for I/O (F\+I\+IO) mechanism, we need to pass -\/D\+E\+N\+A\+B\+L\+E\+\_\+\+F\+I\+\_\+\+IO to the cmake command. We can inject failures for the write (or fwrite) functions in the following functions\+:


\begin{DoxyItemize}
\item F\+T\+I\+\_\+\+Write\+Posix
\item F\+T\+I\+F\+F\+\_\+\+Write\+F\+T\+I\+FF
\item F\+T\+I\+\_\+\+Recv\+Ptner
\item F\+T\+I\+\_\+\+R\+Senc
\item F\+T\+I\+\_\+\+Flush\+Posix
\end{DoxyItemize}

In order to select the function where we want to inject the failure, we need to set the environment variable F\+T\+I\+\_\+\+F\+I\+\_\+\+F\+U\+N\+C\+T\+I\+ON. For instance\+:

F\+T\+I\+\_\+\+F\+I\+\_\+\+F\+U\+N\+C\+T\+I\+ON=F\+T\+I\+\_\+\+Write\+Posix mpirun -\/n 8 ./application

We can set the probability for the failure to hapen by setting the environment variable F\+T\+I\+\_\+\+F\+I\+\_\+\+P\+R\+O\+B\+A\+B\+I\+L\+I\+TY. For instance to inject a failure in function F\+T\+I\+\_\+\+Write\+Posix with probability of 0.\+5\+:

F\+T\+I\+\_\+\+F\+I\+\_\+\+F\+U\+N\+C\+T\+I\+ON=F\+T\+I\+\_\+\+Write\+Posix F\+T\+I\+\_\+\+F\+I\+\_\+\+P\+R\+O\+B\+A\+B\+I\+L\+I\+TY=0.\+5 mpirun -\/n 8 ./application

The default value for the probability is 0.\+1.

\begin{DoxyAuthor}{Author}
Kai Keller (\href{mailto:kellekai@gmx.de}{\texttt{ kellekai@gmx.\+de}})
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
December, 2018 
\end{DoxyDate}


\doxysubsection{Macro Definition Documentation}
\mbox{\Hypertarget{failure-injection_8h_a607620c0311a5e8e774bc7ab80859084}\label{failure-injection_8h_a607620c0311a5e8e774bc7ab80859084}} 
\index{failure-\/injection.h@{failure-\/injection.h}!FTI\_FI\_FWRITE@{FTI\_FI\_FWRITE}}
\index{FTI\_FI\_FWRITE@{FTI\_FI\_FWRITE}!failure-\/injection.h@{failure-\/injection.h}}
\doxysubsubsection{\texorpdfstring{FTI\_FI\_FWRITE}{FTI\_FI\_FWRITE}}
{\footnotesize\ttfamily \#define F\+T\+I\+\_\+\+F\+I\+\_\+\+F\+W\+R\+I\+TE(\begin{DoxyParamCaption}\item[{}]{E\+RR,  }\item[{}]{B\+UF,  }\item[{}]{S\+I\+ZE,  }\item[{}]{C\+O\+U\+NT,  }\item[{}]{F\+S\+T\+R\+E\+AM,  }\item[{}]{FN }\end{DoxyParamCaption})~( E\+RR = fwrite( B\+UF, S\+I\+ZE, C\+O\+U\+NT, F\+S\+T\+R\+E\+AM ) )}

\mbox{\Hypertarget{failure-injection_8h_a7becf28120a1bfa4143d26b2b96e60a2}\label{failure-injection_8h_a7becf28120a1bfa4143d26b2b96e60a2}} 
\index{failure-\/injection.h@{failure-\/injection.h}!FTI\_FI\_WRITE@{FTI\_FI\_WRITE}}
\index{FTI\_FI\_WRITE@{FTI\_FI\_WRITE}!failure-\/injection.h@{failure-\/injection.h}}
\doxysubsubsection{\texorpdfstring{FTI\_FI\_WRITE}{FTI\_FI\_WRITE}}
{\footnotesize\ttfamily \#define F\+T\+I\+\_\+\+F\+I\+\_\+\+W\+R\+I\+TE(\begin{DoxyParamCaption}\item[{}]{E\+RR,  }\item[{}]{FD,  }\item[{}]{B\+UF,  }\item[{}]{C\+O\+U\+NT,  }\item[{}]{FN }\end{DoxyParamCaption})~( E\+RR = write( FD, B\+UF, C\+O\+U\+NT ) )}



\doxysubsection{Function Documentation}
\mbox{\Hypertarget{failure-injection_8h_acd287cd3e5911bb2d8266c0d8219c861}\label{failure-injection_8h_acd287cd3e5911bb2d8266c0d8219c861}} 
\index{failure-\/injection.h@{failure-\/injection.h}!FTI\_DoubleBitFlip@{FTI\_DoubleBitFlip}}
\index{FTI\_DoubleBitFlip@{FTI\_DoubleBitFlip}!failure-\/injection.h@{failure-\/injection.h}}
\doxysubsubsection{\texorpdfstring{FTI\_DoubleBitFlip()}{FTI\_DoubleBitFlip()}}
{\footnotesize\ttfamily int F\+T\+I\+\_\+\+Double\+Bit\+Flip (\begin{DoxyParamCaption}\item[{double $\ast$}]{target,  }\item[{int}]{bit }\end{DoxyParamCaption})}



It corrupts a bit of the given float. 


\begin{DoxyParams}{Parameters}
{\em target} & Pointer to the float to corrupt. \\
\hline
{\em bit} & Position of the bit to corrupt. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
integer F\+T\+I\+\_\+\+S\+C\+ES if successful.
\end{DoxyReturn}
This function filps the bit of the target float. Here is the call graph for this function\+:
% FIG 2
\mbox{\Hypertarget{failure-injection_8h_a791fd93b18d6c214cef5d6b934dcbd55}\label{failure-injection_8h_a791fd93b18d6c214cef5d6b934dcbd55}} 
\index{failure-\/injection.h@{failure-\/injection.h}!FTI\_FloatBitFlip@{FTI\_FloatBitFlip}}
\index{FTI\_FloatBitFlip@{FTI\_FloatBitFlip}!failure-\/injection.h@{failure-\/injection.h}}
\doxysubsubsection{\texorpdfstring{FTI\_FloatBitFlip()}{FTI\_FloatBitFlip()}}
{\footnotesize\ttfamily int F\+T\+I\+\_\+\+Float\+Bit\+Flip (\begin{DoxyParamCaption}\item[{float $\ast$}]{target,  }\item[{int}]{bit }\end{DoxyParamCaption})}



It corrupts a bit of the given float. 


\begin{DoxyParams}{Parameters}
{\em target} & Pointer to the float to corrupt. \\
\hline
{\em bit} & Position of the bit to corrupt. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
integer F\+T\+I\+\_\+\+S\+C\+ES if successful.
\end{DoxyReturn}
This function filps the bit of the target float. \mbox{\Hypertarget{failure-injection_8h_a7acbcfc49eb071c72fcd452dbf00c197}\label{failure-injection_8h_a7acbcfc49eb071c72fcd452dbf00c197}} 
\index{failure-\/injection.h@{failure-\/injection.h}!FTI\_InitFIIO@{FTI\_InitFIIO}}
\index{FTI\_InitFIIO@{FTI\_InitFIIO}!failure-\/injection.h@{failure-\/injection.h}}
\doxysubsubsection{\texorpdfstring{FTI\_InitFIIO()}{FTI\_InitFIIO()}}
{\footnotesize\ttfamily void F\+T\+I\+\_\+\+Init\+F\+I\+IO (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

\mbox{\Hypertarget{failure-injection_8h_a0917c864ec34200ecfbb1dd974658547}\label{failure-injection_8h_a0917c864ec34200ecfbb1dd974658547}} 
\index{failure-\/injection.h@{failure-\/injection.h}!FUNCTION@{FUNCTION}}
\index{FUNCTION@{FUNCTION}!failure-\/injection.h@{failure-\/injection.h}}
\doxysubsubsection{\texorpdfstring{FUNCTION()}{FUNCTION()}}
{\footnotesize\ttfamily unsigned int F\+U\+N\+C\+T\+I\+ON (\begin{DoxyParamCaption}\item[{const char $\ast$}]{test\+Function }\end{DoxyParamCaption})}

\mbox{\Hypertarget{failure-injection_8h_a42d6575e31a765c4780cba60cb923c91}\label{failure-injection_8h_a42d6575e31a765c4780cba60cb923c91}} 
\index{failure-\/injection.h@{failure-\/injection.h}!PROBABILITY@{PROBABILITY}}
\index{PROBABILITY@{PROBABILITY}!failure-\/injection.h@{failure-\/injection.h}}
\doxysubsubsection{\texorpdfstring{PROBABILITY()}{PROBABILITY()}}
{\footnotesize\ttfamily float P\+R\+O\+B\+A\+B\+I\+L\+I\+TY (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

