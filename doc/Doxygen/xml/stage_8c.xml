<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.18">
  <compounddef id="stage_8c" kind="file" language="C++">
    <compoundname>stage.c</compoundname>
    <includes refid="interface_8h" local="yes">interface.h</includes>
    <includes local="no">libgen.h</includes>
    <incdepgraph>
      <node id="32">
        <label>sys/stat.h</label>
      </node>
      <node id="28">
        <label>IO/ftiff.h</label>
      </node>
      <node id="13">
        <label>stdbool.h</label>
      </node>
      <node id="3">
        <label>fti.h</label>
        <link refid="fti_8h"/>
        <childnode refid="4" relation="include">
        </childnode>
      </node>
      <node id="9">
        <label>stdarg.h</label>
      </node>
      <node id="30">
        <label>failure-injection.h</label>
        <link refid="failure-injection_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="31" relation="include">
        </childnode>
        <childnode refid="32" relation="include">
        </childnode>
        <childnode refid="33" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="34" relation="include">
        </childnode>
      </node>
      <node id="45">
        <label>../deps/jerasure/include/galois.h</label>
      </node>
      <node id="17">
        <label>postreco.h</label>
        <link refid="postreco_8h"/>
      </node>
      <node id="2">
        <label>interface.h</label>
        <link refid="interface_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
        <childnode refid="22" relation="include">
        </childnode>
        <childnode refid="23" relation="include">
        </childnode>
        <childnode refid="24" relation="include">
        </childnode>
        <childnode refid="25" relation="include">
        </childnode>
        <childnode refid="26" relation="include">
        </childnode>
        <childnode refid="27" relation="include">
        </childnode>
        <childnode refid="28" relation="include">
        </childnode>
        <childnode refid="29" relation="include">
        </childnode>
        <childnode refid="30" relation="include">
        </childnode>
        <childnode refid="35" relation="include">
        </childnode>
        <childnode refid="36" relation="include">
        </childnode>
        <childnode refid="37" relation="include">
        </childnode>
        <childnode refid="38" relation="include">
        </childnode>
        <childnode refid="39" relation="include">
        </childnode>
        <childnode refid="40" relation="include">
        </childnode>
        <childnode refid="41" relation="include">
        </childnode>
        <childnode refid="43" relation="include">
        </childnode>
        <childnode refid="44" relation="include">
        </childnode>
        <childnode refid="45" relation="include">
        </childnode>
        <childnode refid="46" relation="include">
        </childnode>
        <childnode refid="42" relation="include">
        </childnode>
      </node>
      <node id="11">
        <label>stdint.h</label>
      </node>
      <node id="6">
        <label>stdlib.h</label>
      </node>
      <node id="10">
        <label>errno.h</label>
      </node>
      <node id="38">
        <label>icp.h</label>
        <link refid="icp_8h"/>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
      </node>
      <node id="33">
        <label>fcntl.h</label>
      </node>
      <node id="20">
        <label>conf.h</label>
        <link refid="conf_8h"/>
      </node>
      <node id="35">
        <label>postckpt.h</label>
        <link refid="postckpt_8h"/>
      </node>
      <node id="43">
        <label>../deps/iniparser/iniparser.h</label>
      </node>
      <node id="5">
        <label>stddef.h</label>
      </node>
      <node id="27">
        <label>IO/hdf5-fti.h</label>
      </node>
      <node id="15">
        <label>meta.h</label>
        <link refid="meta_8h"/>
      </node>
      <node id="34">
        <label>limits.h</label>
      </node>
      <node id="21">
        <label>checkpoint.h</label>
        <link refid="checkpoint_8h"/>
      </node>
      <node id="19">
        <label>dcp.h</label>
        <link refid="dcp_8h"/>
      </node>
      <node id="36">
        <label>recover.h</label>
        <link refid="recover_8h"/>
      </node>
      <node id="31">
        <label>sys/types.h</label>
      </node>
      <node id="47">
        <label>libgen.h</label>
      </node>
      <node id="8">
        <label>string.h</label>
      </node>
      <node id="40">
        <label>utility.h</label>
        <link refid="utility_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="41" relation="include">
        </childnode>
        <childnode refid="42" relation="include">
        </childnode>
      </node>
      <node id="1">
        <label>/home/bscuser/Documents/release/dev/fti/src/stage.c</label>
        <link refid="stage_8c"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="47" relation="include">
        </childnode>
      </node>
      <node id="18">
        <label>tools.h</label>
        <link refid="tools_8h"/>
      </node>
      <node id="22">
        <label>stage.h</label>
        <link refid="stage_8h"/>
      </node>
      <node id="12">
        <label>unistd.h</label>
      </node>
      <node id="23">
        <label>fti-io.h</label>
        <link refid="fti-io_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
      </node>
      <node id="4">
        <label>fti-intern.h</label>
        <link refid="fti-intern_8h"/>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
      </node>
      <node id="41">
        <label>../deps/md5/md5.h</label>
      </node>
      <node id="44">
        <label>../deps/iniparser/dictionary.h</label>
      </node>
      <node id="26">
        <label>IO/posix-dcp.h</label>
      </node>
      <node id="25">
        <label>IO/posix.h</label>
      </node>
      <node id="46">
        <label>../deps/jerasure/include/jerasure.h</label>
      </node>
      <node id="14">
        <label>mpi.h</label>
      </node>
      <node id="29">
        <label>IO/ftiff-dcp.h</label>
      </node>
      <node id="42">
        <label>sion.h</label>
      </node>
      <node id="39">
        <label>macros.h</label>
        <link refid="macros_8h"/>
      </node>
      <node id="37">
        <label>fortran/ftif.h</label>
      </node>
      <node id="7">
        <label>stdio.h</label>
      </node>
      <node id="24">
        <label>topo.h</label>
        <link refid="topo_8h"/>
      </node>
      <node id="16">
        <label>api-cuda.h</label>
        <link refid="api-cuda_8h"/>
        <childnode refid="2" relation="include">
        </childnode>
      </node>
    </incdepgraph>
      <sectiondef kind="var">
      <memberdef kind="variable" id="stage_8c_1a3f6d12070edbff94288f17d9e19d154a" prot="public" static="yes" mutable="no">
        <type>MPI_Datatype</type>
        <definition>MPI_Datatype buf_t</definition>
        <argsstring></argsstring>
        <name>buf_t</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><xrefsect id="todo_1_todo000001"><xreftitle>Todo</xreftitle><xrefdescription><para>(1) supply function to remove all files from staging folder. </para>
</xrefdescription></xrefsect><simplesect kind="par"><title></title><para>(2) add flag to FTI_SendFile( ..., FTI_SI_RM ) that indicates if the local file shall be deleted at success or failure. </para>
</simplesect>
<simplesect kind="par"><title></title><para>(3) implement an interrupt for the staging process of the heads in order to allow the heads to process the checkpoints as soon as requested. MPI derived datatype to send staging info <linebreak/>
 </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/bscuser/Documents/release/dev/fti/src/stage.c" line="70" column="21" bodyfile="/home/bscuser/Documents/release/dev/fti/src/stage.c" bodystart="70" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="stage_8c_1aea6c4b77cee168e0a81df4ad7af2c2d9" prot="public" static="yes" mutable="no">
        <type>uint32_t *</type>
        <definition>uint32_t* idxRequest</definition>
        <argsstring></argsstring>
        <name>idxRequest</name>
        <briefdescription>
<para>Look-up table for the stage info request array elements. </para>
        </briefdescription>
        <detaileddescription>
<para>The elements of the array, &apos;idxRequest&apos;, keep informations about &apos;ID&apos; at &apos;idxRequest[ID]&apos;. These are a flag if for &apos;ID&apos; exists an allocated request element and if, the index of the ID corresponding element fo &apos;FTI_Exec-&gt;stageInfo-&gt;request&apos;. The two fields may be requested by &apos;FTI_GetRequestFiled&apos; and may be set by &apos;FTI_SetRequestField&apos;. The most significant 19 bits hold the indices and the 20th bit holds a flag that indicates if the ID has a corresponding request structure allocated. the bits 21 to 32 are free. Only the application ranks allocate memory for this field. The head processes use a linear search to locate the &apos;ID&apos; corresponding request element. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/bscuser/Documents/release/dev/fti/src/stage.c" line="87" column="17" bodyfile="/home/bscuser/Documents/release/dev/fti/src/stage.c" bodystart="87" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="stage_8c_1a5daa21eee463a93be2e25ad0b39cab77" prot="public" static="yes" mutable="no">
        <type>uint8_t *</type>
        <definition>uint8_t* status</definition>
        <argsstring></argsstring>
        <name>status</name>
        <briefdescription>
<para>holds status of the user requested staging action. </para>
        </briefdescription>
        <detaileddescription>
<para>this variable is a contiguous memory region partitioned into &apos;FTI_SI_MAX_NUM&apos; 8 bit fields. The elements of the region are assigned to the corresponding &apos;ID&apos; at &apos;status[ID]&apos;. The first significant bit of the status field keeps a flag that indicates whether the &apos;ID&apos; is available and the next 3 bits encode 5 statuses; &apos;not initialized&apos;, &apos;pending&apos;, &apos;active&apos;, &apos;failed&apos; or &apos;success&apos;. Only the application ranks allocate memory for this field (the heads never request staging). However, the field is exposed to all the ranks on the common node using a shared memory MPI window. Since the staging is supposed to operate asynchronously, this allows the dedicated process to set the proper status &apos;remotely&apos;. <linebreak/>
 </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/bscuser/Documents/release/dev/fti/src/stage.c" line="104" column="16" bodyfile="/home/bscuser/Documents/release/dev/fti/src/stage.c" bodystart="104" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="stage_8c_1a1d6dca4b633b127f3e0a031d913c0033" prot="public" static="yes" mutable="no">
        <type>MPI_Win</type>
        <definition>MPI_Win stageWin</definition>
        <argsstring></argsstring>
        <name>stageWin</name>
        <briefdescription>
<para>shared memory window to query the status field address. </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/bscuser/Documents/release/dev/fti/src/stage.c" line="109" column="16" bodyfile="/home/bscuser/Documents/release/dev/fti/src/stage.c" bodystart="109" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="stage_8c_1aa87515a70bb1baf5099115ba29c40f36" prot="public" static="yes" mutable="no">
        <type>bool *</type>
        <definition>bool* enableStagingPtr</definition>
        <argsstring></argsstring>
        <name>enableStagingPtr</name>
        <briefdescription>
<para>pointer to FTI_Conf-&gt;stagingEnabled (set in &apos;FTI_InitStage&apos;). </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/bscuser/Documents/release/dev/fti/src/stage.c" line="114" column="13" bodyfile="/home/bscuser/Documents/release/dev/fti/src/stage.c" bodystart="114" bodyend="-1"/>
      </memberdef>
      </sectiondef>
      <sectiondef kind="func">
      <memberdef kind="function" id="stage_8c_1a46b8c1f1c37f48eb4261fc646e460478" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int FTI_InitStage</definition>
        <argsstring>(FTIT_execution *FTI_Exec, FTIT_configuration *FTI_Conf, FTIT_topology *FTI_Topo)</argsstring>
        <name>FTI_InitStage</name>
        <param>
          <type><ref refid="structFTIT__execution" kindref="compound">FTIT_execution</ref> *</type>
          <declname>FTI_Exec</declname>
        </param>
        <param>
          <type><ref refid="structFTIT__configuration" kindref="compound">FTIT_configuration</ref> *</type>
          <declname>FTI_Conf</declname>
        </param>
        <param>
          <type><ref refid="structFTIT__topology" kindref="compound">FTIT_topology</ref> *</type>
          <declname>FTI_Topo</declname>
        </param>
        <briefdescription>
<para>Initializes the FTI staging feature. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>FTI_Exec</parametername>
</parameternamelist>
<parameterdescription>
<para>Execution metadata. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>FTI_Conf</parametername>
</parameternamelist>
<parameterdescription>
<para>Configuration metadata. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>FTI_Topo</parametername>
</parameternamelist>
<parameterdescription>
<para>Topology metadata.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
This function allocates memory for the &apos;idxRequest&apos; and &apos;status&apos; fields, creates a node communicator and an MPI shared memory window. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/bscuser/Documents/release/dev/fti/src/stage.c" line="127" column="5" bodyfile="/home/bscuser/Documents/release/dev/fti/src/stage.c" bodystart="127" bodyend="234"/>
      </memberdef>
      <memberdef kind="function" id="stage_8c_1acf6cca854e653c7c23d24011f5b3afc4" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void FTI_FinalizeStage</definition>
        <argsstring>(FTIT_execution *FTI_Exec, FTIT_topology *FTI_Topo, FTIT_configuration *FTI_Conf)</argsstring>
        <name>FTI_FinalizeStage</name>
        <param>
          <type><ref refid="structFTIT__execution" kindref="compound">FTIT_execution</ref> *</type>
          <declname>FTI_Exec</declname>
        </param>
        <param>
          <type><ref refid="structFTIT__topology" kindref="compound">FTIT_topology</ref> *</type>
          <declname>FTI_Topo</declname>
        </param>
        <param>
          <type><ref refid="structFTIT__configuration" kindref="compound">FTIT_configuration</ref> *</type>
          <declname>FTI_Conf</declname>
        </param>
        <briefdescription>
<para>Finalizes staging feature. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>FTI_Exec</parametername>
</parameternamelist>
<parameterdescription>
<para>Execution metadata. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>FTI_Topo</parametername>
</parameternamelist>
<parameterdescription>
<para>Topology metadata. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>FTI_Conf</parametername>
</parameternamelist>
<parameterdescription>
<para>Configuration metadata.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
This function frees allocated ressources, removes local staging files and the staging directory and destroys the node communicator </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/bscuser/Documents/release/dev/fti/src/stage.c" line="247" column="6" bodyfile="/home/bscuser/Documents/release/dev/fti/src/stage.c" bodystart="247" bodyend="304"/>
      </memberdef>
      <memberdef kind="function" id="stage_8c_1add93ac9ae93c0bc729d2d68f1617341c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int FTI_InitStageRequestApp</definition>
        <argsstring>(FTIT_execution *FTI_Exec, FTIT_topology *FTI_Topo, uint32_t ID)</argsstring>
        <name>FTI_InitStageRequestApp</name>
        <param>
          <type><ref refid="structFTIT__execution" kindref="compound">FTIT_execution</ref> *</type>
          <declname>FTI_Exec</declname>
        </param>
        <param>
          <type><ref refid="structFTIT__topology" kindref="compound">FTIT_topology</ref> *</type>
          <declname>FTI_Topo</declname>
        </param>
        <param>
          <type>uint32_t</type>
          <declname>ID</declname>
        </param>
        <briefdescription>
<para>Initializes new stage meta info element (application rank) </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>FTI_Exec</parametername>
</parameternamelist>
<parameterdescription>
<para>Execution metadata. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>FTI_Topo</parametername>
</parameternamelist>
<parameterdescription>
<para>Topology metadata. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>integer</parametername>
</parameternamelist>
<parameterdescription>
<para>&apos;ID&apos; of staging request</para>
</parameterdescription>
</parameteritem>
</parameterlist>
This function appends a new staging meta info element for the application ranks to &apos;FTI_Exec-&gt;stageInfo-&gt;request&apos;. Beside that it also initializes the status field (status -&gt; pending) corresponding to &apos;ID&apos; and assigns the proper index of the meta info element to the &apos;ID&apos; corresponding &apos;idxRequest&apos; field. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/bscuser/Documents/release/dev/fti/src/stage.c" line="323" column="5" bodyfile="/home/bscuser/Documents/release/dev/fti/src/stage.c" bodystart="323" bodyend="355"/>
      </memberdef>
      <memberdef kind="function" id="stage_8c_1ae4b37a2f01edc58f583e828993eda152" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int FTI_InitStageRequestHead</definition>
        <argsstring>(char *lpath, char *rpath, FTIT_execution *FTI_Exec, FTIT_topology *FTI_Topo, int source, uint32_t ID)</argsstring>
        <name>FTI_InitStageRequestHead</name>
        <param>
          <type>char *</type>
          <declname>lpath</declname>
        </param>
        <param>
          <type>char *</type>
          <declname>rpath</declname>
        </param>
        <param>
          <type><ref refid="structFTIT__execution" kindref="compound">FTIT_execution</ref> *</type>
          <declname>FTI_Exec</declname>
        </param>
        <param>
          <type><ref refid="structFTIT__topology" kindref="compound">FTIT_topology</ref> *</type>
          <declname>FTI_Topo</declname>
        </param>
        <param>
          <type>int</type>
          <declname>source</declname>
        </param>
        <param>
          <type>uint32_t</type>
          <declname>ID</declname>
        </param>
        <briefdescription>
<para>Initializes new stage meta info element (head rank) </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>string</parametername>
</parameternamelist>
<parameterdescription>
<para>&apos;lpath&apos;, absolute path of local file </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>string</parametername>
</parameternamelist>
<parameterdescription>
<para>&apos;rpath&apos;, absolute path of remote file </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>FTI_Exec</parametername>
</parameternamelist>
<parameterdescription>
<para>Execution metadata. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>FTI_Topo</parametername>
</parameternamelist>
<parameterdescription>
<para>Topology metadata. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>integer</parametername>
</parameternamelist>
<parameterdescription>
<para>&apos;source&apos;, application rank of stage request </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>integer</parametername>
</parameternamelist>
<parameterdescription>
<para>&apos;ID&apos; of staging request </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>&apos;FTI_SCES&apos; on success, &apos;FTI_NSCS&apos; else. <linebreak/>
</para>
</simplesect>
This function appends a new staging meta info element for the head ranks to &apos;FTI_Exec-&gt;stageInfo-&gt;request&apos;. Beside that it also changes the status field corresponding to &apos;ID&apos; (status -&gt; active). </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/bscuser/Documents/release/dev/fti/src/stage.c" line="373" column="5" bodyfile="/home/bscuser/Documents/release/dev/fti/src/stage.c" bodystart="373" bodyend="406"/>
      </memberdef>
      <memberdef kind="function" id="stage_8c_1a6e74aba3e759272cbdb8db6ccbb879f2" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int FTI_FreeStageRequest</definition>
        <argsstring>(FTIT_execution *FTI_Exec, FTIT_topology *FTI_Topo, int ID, int source)</argsstring>
        <name>FTI_FreeStageRequest</name>
        <param>
          <type><ref refid="structFTIT__execution" kindref="compound">FTIT_execution</ref> *</type>
          <declname>FTI_Exec</declname>
        </param>
        <param>
          <type><ref refid="structFTIT__topology" kindref="compound">FTIT_topology</ref> *</type>
          <declname>FTI_Topo</declname>
        </param>
        <param>
          <type>int</type>
          <declname>ID</declname>
        </param>
        <param>
          <type>int</type>
          <declname>source</declname>
        </param>
        <briefdescription>
<para>frees stage meta info element (head/application rank) </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>FTI_Exec</parametername>
</parameternamelist>
<parameterdescription>
<para>Execution metadata. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>FTI_Topo</parametername>
</parameternamelist>
<parameterdescription>
<para>Topology metadata. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>integer</parametername>
</parameternamelist>
<parameterdescription>
<para>&apos;ID&apos; of staging request </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>integer</parametername>
</parameternamelist>
<parameterdescription>
<para>&apos;source&apos;, application rank of stage request</para>
</parameterdescription>
</parameteritem>
</parameterlist>
This function eliminates the &apos;ID&apos; corresponding element from the stage meta info array and frees the corresponding memory. In the application ranks it also reorders the index information in the &apos;idxRequest√Ñ array corresponding to &apos;ID&apos;. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/bscuser/Documents/release/dev/fti/src/stage.c" line="422" column="5" bodyfile="/home/bscuser/Documents/release/dev/fti/src/stage.c" bodystart="422" bodyend="549"/>
      </memberdef>
      <memberdef kind="function" id="stage_8c_1a0c5a2182e719ef3336289bd24f8fd312" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int FTI_GetRequestIdx</definition>
        <argsstring>(int ID)</argsstring>
        <name>FTI_GetRequestIdx</name>
        <param>
          <type>int</type>
          <declname>ID</declname>
        </param>
        <briefdescription>
<para>returns the index of desired stage meta info element. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>integer</parametername>
</parameternamelist>
<parameterdescription>
<para>&apos;ID&apos; of staging request </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>index if &apos;ID&apos; corresponding meta info structure was allocated -1, else. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/bscuser/Documents/release/dev/fti/src/stage.c" line="559" column="5" bodyfile="/home/bscuser/Documents/release/dev/fti/src/stage.c" bodystart="559" bodyend="567"/>
        <references refid="stage_8c_1a1b29cd8c8e9446f2dbd8dafac4d07f05" compoundref="stage_8c" startline="998" endline="1031">FTI_GetRequestField</references>
        <references refid="stage_8h_1a05ee3f86e04233d44812d99f1ce02f98a284a69ddc599e948a41d29045bf417a7" compoundref="stage_8h" startline="84">FTI_SIF_ALL</references>
        <references refid="stage_8h_1a05ee3f86e04233d44812d99f1ce02f98a45cfcc08399841b15ebd1df39e23cfa8" compoundref="stage_8h" startline="85">FTI_SIF_IDX</references>
      </memberdef>
      <memberdef kind="function" id="stage_8c_1a182f1f60a5374160a724cee0034c572d" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int FTI_SyncStage</definition>
        <argsstring>(char *lpath, char *rpath, FTIT_execution *FTI_Exec, FTIT_topology *FTI_Topo, FTIT_configuration *FTI_Conf, uint32_t ID)</argsstring>
        <name>FTI_SyncStage</name>
        <param>
          <type>char *</type>
          <declname>lpath</declname>
        </param>
        <param>
          <type>char *</type>
          <declname>rpath</declname>
        </param>
        <param>
          <type><ref refid="structFTIT__execution" kindref="compound">FTIT_execution</ref> *</type>
          <declname>FTI_Exec</declname>
        </param>
        <param>
          <type><ref refid="structFTIT__topology" kindref="compound">FTIT_topology</ref> *</type>
          <declname>FTI_Topo</declname>
        </param>
        <param>
          <type><ref refid="structFTIT__configuration" kindref="compound">FTIT_configuration</ref> *</type>
          <declname>FTI_Conf</declname>
        </param>
        <param>
          <type>uint32_t</type>
          <declname>ID</declname>
        </param>
        <briefdescription>
<para>This function synchronously stages the local file to the PFS. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>string</parametername>
</parameternamelist>
<parameterdescription>
<para>&apos;lpath&apos;, absolute path of local file </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>string</parametername>
</parameternamelist>
<parameterdescription>
<para>&apos;rpath&apos;, absolute path of remote file </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>FTI_Exec</parametername>
</parameternamelist>
<parameterdescription>
<para>Execution metadata. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>FTI_Topo</parametername>
</parameternamelist>
<parameterdescription>
<para>Topology metadata. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>FTI_Conf</parametername>
</parameternamelist>
<parameterdescription>
<para>Configuration metadata. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>integer</parametername>
</parameternamelist>
<parameterdescription>
<para>&apos;ID&apos; of staging request </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>&apos;FTI_SCES&apos; on success, &apos;FTI_NSCS&apos; else. <linebreak/>
</para>
</simplesect>
This function should be called only if the staging feature is enabled without the head process being enabled. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/bscuser/Documents/release/dev/fti/src/stage.c" line="584" column="5" bodyfile="/home/bscuser/Documents/release/dev/fti/src/stage.c" bodystart="584" bodyend="736"/>
      </memberdef>
      <memberdef kind="function" id="stage_8c_1a61d6e550d9f80163986a523bc8f2d33d" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int FTI_AsyncStage</definition>
        <argsstring>(char *lpath, char *rpath, FTIT_configuration *FTI_Conf, FTIT_execution *FTI_Exec, FTIT_topology *FTI_Topo, int ID)</argsstring>
        <name>FTI_AsyncStage</name>
        <param>
          <type>char *</type>
          <declname>lpath</declname>
        </param>
        <param>
          <type>char *</type>
          <declname>rpath</declname>
        </param>
        <param>
          <type><ref refid="structFTIT__configuration" kindref="compound">FTIT_configuration</ref> *</type>
          <declname>FTI_Conf</declname>
        </param>
        <param>
          <type><ref refid="structFTIT__execution" kindref="compound">FTIT_execution</ref> *</type>
          <declname>FTI_Exec</declname>
        </param>
        <param>
          <type><ref refid="structFTIT__topology" kindref="compound">FTIT_topology</ref> *</type>
          <declname>FTI_Topo</declname>
        </param>
        <param>
          <type>int</type>
          <declname>ID</declname>
        </param>
        <briefdescription>
<para>This function triggers the asynchronous stage. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>string</parametername>
</parameternamelist>
<parameterdescription>
<para>&apos;lpath&apos;, absolute path of local file </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>string</parametername>
</parameternamelist>
<parameterdescription>
<para>&apos;rpath&apos;, absolute path of remote file </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>FTI_Exec</parametername>
</parameternamelist>
<parameterdescription>
<para>Execution metadata. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>FTI_Topo</parametername>
</parameternamelist>
<parameterdescription>
<para>Topology metadata. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>FTI_Conf</parametername>
</parameternamelist>
<parameterdescription>
<para>Configuration metadata. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>integer</parametername>
</parameternamelist>
<parameterdescription>
<para>&apos;ID&apos; of staging request </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>&apos;FTI_SCES&apos; on success, &apos;FTI_NSCS&apos; else.</para>
</simplesect>
This function uses a non-blocking send (MPI_Isend) in order to pass the information that is needed by the head process to perform an asynchronous staging of the local file to the PFS. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/bscuser/Documents/release/dev/fti/src/stage.c" line="754" column="5" bodyfile="/home/bscuser/Documents/release/dev/fti/src/stage.c" bodystart="754" bodyend="785"/>
      </memberdef>
      <memberdef kind="function" id="stage_8c_1a7e59d3bafaa826d69a91493c80a417e3" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int FTI_HandleStageRequest</definition>
        <argsstring>(FTIT_configuration *FTI_Conf, FTIT_execution *FTI_Exec, FTIT_topology *FTI_Topo, FTIT_checkpoint *FTI_Ckpt, int source)</argsstring>
        <name>FTI_HandleStageRequest</name>
        <param>
          <type><ref refid="structFTIT__configuration" kindref="compound">FTIT_configuration</ref> *</type>
          <declname>FTI_Conf</declname>
        </param>
        <param>
          <type><ref refid="structFTIT__execution" kindref="compound">FTIT_execution</ref> *</type>
          <declname>FTI_Exec</declname>
        </param>
        <param>
          <type><ref refid="structFTIT__topology" kindref="compound">FTIT_topology</ref> *</type>
          <declname>FTI_Topo</declname>
        </param>
        <param>
          <type><ref refid="structFTIT__checkpoint" kindref="compound">FTIT_checkpoint</ref> *</type>
          <declname>FTI_Ckpt</declname>
        </param>
        <param>
          <type>int</type>
          <declname>source</declname>
        </param>
        <briefdescription>
<para>This function asynchronously stages the local file to the PFS. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>string</parametername>
</parameternamelist>
<parameterdescription>
<para>&apos;lpath&apos;, absolute path of local file. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>string</parametername>
</parameternamelist>
<parameterdescription>
<para>&apos;rpath&apos;, absolute path of remote file. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>FTI_Exec</parametername>
</parameternamelist>
<parameterdescription>
<para>Execution metadata. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>FTI_Topo</parametername>
</parameternamelist>
<parameterdescription>
<para>Topology metadata. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>FTI_Conf</parametername>
</parameternamelist>
<parameterdescription>
<para>Configuration metadata. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>integer</parametername>
</parameternamelist>
<parameterdescription>
<para>&apos;source&apos;, application rank of stage request. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>&apos;FTI_SCES&apos; on success, &apos;FTI_NSCS&apos; else. <linebreak/>
 </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/bscuser/Documents/release/dev/fti/src/stage.c" line="799" column="5" bodyfile="/home/bscuser/Documents/release/dev/fti/src/stage.c" bodystart="799" bodyend="988"/>
      </memberdef>
      <memberdef kind="function" id="stage_8c_1a1b29cd8c8e9446f2dbd8dafac4d07f05" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int FTI_GetRequestField</definition>
        <argsstring>(int ID, FTIT_RequestField val)</argsstring>
        <name>FTI_GetRequestField</name>
        <param>
          <type>int</type>
          <declname>ID</declname>
        </param>
        <param>
          <type><ref refid="stage_8h_1a05ee3f86e04233d44812d99f1ce02f98" kindref="member">FTIT_RequestField</ref></type>
          <declname>val</declname>
        </param>
        <briefdescription>
<para>Returns value from the &apos;idxRequest&apos; field array at &apos;ID&apos;. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>integer</parametername>
</parameternamelist>
<parameterdescription>
<para>&apos;ID&apos; of staging request </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>FTIT_StatusField</parametername>
</parameternamelist>
<parameterdescription>
<para>requested field </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Field value on success, &apos;FTI_NSCS&apos; else. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/bscuser/Documents/release/dev/fti/src/stage.c" line="998" column="5" bodyfile="/home/bscuser/Documents/release/dev/fti/src/stage.c" bodystart="998" bodyend="1031"/>
        <references refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" compoundref="fti_8h" startline="20">FTI_NSCS</references>
        <references refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" compoundref="api_8c" startline="2548" endline="2576">FTI_Print</references>
        <references refid="stage_8h_1aa81d3d5a8f468c54e216747e4937c77c" compoundref="stage_8h" startline="64">FTI_SI_ENABLED</references>
        <references refid="stage_8h_1a05ee3f86e04233d44812d99f1ce02f98a284a69ddc599e948a41d29045bf417a7" compoundref="stage_8h" startline="84">FTI_SIF_ALL</references>
        <references refid="stage_8h_1a05ee3f86e04233d44812d99f1ce02f98a45cfcc08399841b15ebd1df39e23cfa8" compoundref="stage_8h" startline="85">FTI_SIF_IDX</references>
        <references refid="fti-intern_8h_1a93eeeef1e283517099194859e3811ea3" compoundref="fti-intern_8h" startline="59">FTI_WARN</references>
      </memberdef>
      <memberdef kind="function" id="stage_8c_1a35eb6e7616b99b2d7713d802327fe061" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int FTI_SetRequestField</definition>
        <argsstring>(int ID, uint32_t entry, FTIT_RequestField val)</argsstring>
        <name>FTI_SetRequestField</name>
        <param>
          <type>int</type>
          <declname>ID</declname>
        </param>
        <param>
          <type>uint32_t</type>
          <declname>entry</declname>
        </param>
        <param>
          <type><ref refid="stage_8h_1a05ee3f86e04233d44812d99f1ce02f98" kindref="member">FTIT_RequestField</ref></type>
          <declname>val</declname>
        </param>
        <briefdescription>
<para>Sets value of the &apos;idxRequest&apos; field array at &apos;ID&apos;. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>integer</parametername>
</parameternamelist>
<parameterdescription>
<para>&apos;ID&apos; of staging request </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>integer</parametername>
</parameternamelist>
<parameterdescription>
<para>&apos;entry&apos;, new value of field </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>FTIT_StatusField</parametername>
</parameternamelist>
<parameterdescription>
<para>requested field </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>&apos;entry&apos; on success, &apos;FTI_NSCS&apos; else. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/bscuser/Documents/release/dev/fti/src/stage.c" line="1042" column="5" bodyfile="/home/bscuser/Documents/release/dev/fti/src/stage.c" bodystart="1042" bodyend="1090"/>
        <references refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" compoundref="fti_8h" startline="20">FTI_NSCS</references>
        <references refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" compoundref="api_8c" startline="2548" endline="2576">FTI_Print</references>
        <references refid="stage_8h_1aa81d3d5a8f468c54e216747e4937c77c" compoundref="stage_8h" startline="64">FTI_SI_ENABLED</references>
        <references refid="stage_8h_1a05ee3f86e04233d44812d99f1ce02f98a284a69ddc599e948a41d29045bf417a7" compoundref="stage_8h" startline="84">FTI_SIF_ALL</references>
        <references refid="stage_8h_1a05ee3f86e04233d44812d99f1ce02f98a45cfcc08399841b15ebd1df39e23cfa8" compoundref="stage_8h" startline="85">FTI_SIF_IDX</references>
        <references refid="fti-intern_8h_1a93eeeef1e283517099194859e3811ea3" compoundref="fti-intern_8h" startline="59">FTI_WARN</references>
      </memberdef>
      <memberdef kind="function" id="stage_8c_1a03ebd25f6254d11bc790e70e9aabd9eb" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int FTI_GetStatusField</definition>
        <argsstring>(FTIT_execution *FTI_Exec, FTIT_topology *FTI_Topo, int ID, FTIT_StatusField val, int source)</argsstring>
        <name>FTI_GetStatusField</name>
        <param>
          <type><ref refid="structFTIT__execution" kindref="compound">FTIT_execution</ref> *</type>
          <declname>FTI_Exec</declname>
        </param>
        <param>
          <type><ref refid="structFTIT__topology" kindref="compound">FTIT_topology</ref> *</type>
          <declname>FTI_Topo</declname>
        </param>
        <param>
          <type>int</type>
          <declname>ID</declname>
        </param>
        <param>
          <type><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887" kindref="member">FTIT_StatusField</ref></type>
          <declname>val</declname>
        </param>
        <param>
          <type>int</type>
          <declname>source</declname>
        </param>
        <briefdescription>
<para>Returns value from the &apos;status&apos; field array at &apos;ID&apos;. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>FTI_Exec</parametername>
</parameternamelist>
<parameterdescription>
<para>Execution metadata. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>FTI_Topo</parametername>
</parameternamelist>
<parameterdescription>
<para>Topology metadata. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>integer</parametername>
</parameternamelist>
<parameterdescription>
<para>&apos;ID&apos; of staging request </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>FTIT_StatusField</parametername>
</parameternamelist>
<parameterdescription>
<para>requested field </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>integer</parametername>
</parameternamelist>
<parameterdescription>
<para>&apos;source&apos;, application rank of stage request. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Field value on success, &apos;FTI_NSCS&apos; else. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/bscuser/Documents/release/dev/fti/src/stage.c" line="1103" column="5" bodyfile="/home/bscuser/Documents/release/dev/fti/src/stage.c" bodystart="1103" bodyend="1139"/>
      </memberdef>
      <memberdef kind="function" id="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int FTI_SetStatusField</definition>
        <argsstring>(FTIT_execution *FTI_Exec, FTIT_topology *FTI_Topo, int ID, uint8_t entry, FTIT_StatusField val, int source)</argsstring>
        <name>FTI_SetStatusField</name>
        <param>
          <type><ref refid="structFTIT__execution" kindref="compound">FTIT_execution</ref> *</type>
          <declname>FTI_Exec</declname>
        </param>
        <param>
          <type><ref refid="structFTIT__topology" kindref="compound">FTIT_topology</ref> *</type>
          <declname>FTI_Topo</declname>
        </param>
        <param>
          <type>int</type>
          <declname>ID</declname>
        </param>
        <param>
          <type>uint8_t</type>
          <declname>entry</declname>
        </param>
        <param>
          <type><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887" kindref="member">FTIT_StatusField</ref></type>
          <declname>val</declname>
        </param>
        <param>
          <type>int</type>
          <declname>source</declname>
        </param>
        <briefdescription>
<para>Sets value from the &apos;status&apos; field array at &apos;ID&apos;. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>FTI_Exec</parametername>
</parameternamelist>
<parameterdescription>
<para>Execution metadata. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>FTI_Topo</parametername>
</parameternamelist>
<parameterdescription>
<para>Topology metadata. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>integer</parametername>
</parameternamelist>
<parameterdescription>
<para>&apos;ID&apos; of staging request </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>integer</parametername>
</parameternamelist>
<parameterdescription>
<para>&apos;entry&apos;, new value of field </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>FTIT_StatusField</parametername>
</parameternamelist>
<parameterdescription>
<para>requested field </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>integer</parametername>
</parameternamelist>
<parameterdescription>
<para>&apos;source&apos;, application rank of stage request. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>&apos;entry&apos; value on success, &apos;FTI_NSCS&apos; else. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/bscuser/Documents/release/dev/fti/src/stage.c" line="1153" column="5" bodyfile="/home/bscuser/Documents/release/dev/fti/src/stage.c" bodystart="1153" bodyend="1203"/>
      </memberdef>
      <memberdef kind="function" id="stage_8c_1af704cfca36ed0ca9ab685a838518c114" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int FTI_GetRequestID</definition>
        <argsstring>(FTIT_execution *FTI_Exec, FTIT_topology *FTI_Topo)</argsstring>
        <name>FTI_GetRequestID</name>
        <param>
          <type><ref refid="structFTIT__execution" kindref="compound">FTIT_execution</ref> *</type>
          <declname>FTI_Exec</declname>
        </param>
        <param>
          <type><ref refid="structFTIT__topology" kindref="compound">FTIT_topology</ref> *</type>
          <declname>FTI_Topo</declname>
        </param>
        <briefdescription>
<para>Returns unique &apos;ID&apos; for staging request. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>FTI_Exec</parametername>
</parameternamelist>
<parameterdescription>
<para>Execution metadata. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>FTI_Topo</parametername>
</parameternamelist>
<parameterdescription>
<para>Topology metadata. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>&apos;ID&apos; on success, -1 else. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/bscuser/Documents/release/dev/fti/src/stage.c" line="1213" column="5" bodyfile="/home/bscuser/Documents/release/dev/fti/src/stage.c" bodystart="1213" bodyend="1240"/>
      </memberdef>
      <memberdef kind="function" id="stage_8c_1a11011f5e2b91e35d66c5c39d33aa0aae" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void FTI_PrintStageStatus</definition>
        <argsstring>(FTIT_execution *FTI_Exec, FTIT_topology *FTI_Topo, int ID, int source)</argsstring>
        <name>FTI_PrintStageStatus</name>
        <param>
          <type><ref refid="structFTIT__execution" kindref="compound">FTIT_execution</ref> *</type>
          <declname>FTI_Exec</declname>
        </param>
        <param>
          <type><ref refid="structFTIT__topology" kindref="compound">FTIT_topology</ref> *</type>
          <declname>FTI_Topo</declname>
        </param>
        <param>
          <type>int</type>
          <declname>ID</declname>
        </param>
        <param>
          <type>int</type>
          <declname>source</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/home/bscuser/Documents/release/dev/fti/src/stage.c" line="1243" column="6" bodyfile="/home/bscuser/Documents/release/dev/fti/src/stage.c" bodystart="1243" bodyend="1302"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
<para>helper functions for the FTI staging feature. </para>
    </briefdescription>
    <detaileddescription>
<para>header for <ref refid="stage_8c" kindref="compound">stage.c</ref></para>
<para>Copyright (c) 2017 Leonardo A. Bautista-Gomez All rights reserved</para>
<para>FTI - A multi-level checkpointing library for C/C++/Fortran applications</para>
<para>Revision 1.0 : Fault Tolerance Interface (FTI)</para>
<para>Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</para>
<para><orderedlist>
<listitem><para>Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</para>
</listitem><listitem><para>Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</para>
</listitem><listitem><para>Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</para>
</listitem></orderedlist>
</para>
<para>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</para>
<para><simplesect kind="author"><para>Kai Keller (<ulink url="mailto:kellekai@gmx.de">kellekai@gmx.de</ulink>)</para>
</simplesect>
<simplesect kind="date"><para>July, 2018 </para>
</simplesect>
</para>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"></codeline>
<codeline lineno="42"><highlight class="preprocessor">#include<sp/>&quot;<ref refid="interface_8h" kindref="compound">interface.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="43"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;libgen.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight></codeline>
<codeline lineno="57"><highlight class="comment">/*<sp/>@note<sp/></highlight></codeline>
<codeline lineno="58"><highlight class="comment"><sp/>*<sp/>The<sp/>status<sp/>variable<sp/>is<sp/>assumed<sp/>to<sp/>be<sp/>written<sp/>in<sp/>an<sp/>atomic<sp/>operation</highlight></codeline>
<codeline lineno="59"><highlight class="comment"><sp/>*<sp/>since<sp/>it<sp/>is<sp/>a<sp/>8-bit<sp/>data<sp/>type</highlight></codeline>
<codeline lineno="60"><highlight class="comment"><sp/>*<sp/>(https://stackoverflow.com/questions/24931456/how-does-sig-atomic-t-actually-work)</highlight></codeline>
<codeline lineno="61"><highlight class="comment"><sp/>*<sp/>@par</highlight></codeline>
<codeline lineno="62"><highlight class="comment"><sp/>*<sp/>However,<sp/>we<sp/>need<sp/>to<sp/>assure,<sp/>that<sp/>operations<sp/>that<sp/>consist<sp/>of<sp/>multiple</highlight></codeline>
<codeline lineno="63"><highlight class="comment"><sp/>*<sp/>instructions<sp/>are<sp/>performed<sp/>on<sp/>a<sp/>copy<sp/>of<sp/>the<sp/>status<sp/>field.<sp/>The<sp/>final</highlight></codeline>
<codeline lineno="64"><highlight class="comment"><sp/>*<sp/>value<sp/>of<sp/>the<sp/>copy<sp/>is<sp/>then<sp/>assigned<sp/>to<sp/>the<sp/><sp/>original<sp/>status<sp/>field</highlight></codeline>
<codeline lineno="65"><highlight class="comment"><sp/>*<sp/>variable<sp/>in<sp/>memory.</highlight></codeline>
<codeline lineno="66"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="67"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="68"><highlight class="normal"></highlight></codeline>
<codeline lineno="70"><highlight class="keyword">static</highlight><highlight class="normal"><sp/>MPI_Datatype<sp/>buf_t;</highlight></codeline>
<codeline lineno="71"><highlight class="normal"></highlight></codeline>
<codeline lineno="87"><highlight class="keyword">static</highlight><highlight class="normal"><sp/>uint32_t<sp/>*idxRequest;</highlight></codeline>
<codeline lineno="88"><highlight class="normal"></highlight></codeline>
<codeline lineno="104"><highlight class="keyword">static</highlight><highlight class="normal"><sp/>uint8_t<sp/>*status;</highlight></codeline>
<codeline lineno="105"><highlight class="normal"></highlight></codeline>
<codeline lineno="109"><highlight class="keyword">static</highlight><highlight class="normal"><sp/>MPI_Win<sp/>stageWin;</highlight></codeline>
<codeline lineno="110"><highlight class="normal"></highlight></codeline>
<codeline lineno="114"><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>*enableStagingPtr;</highlight></codeline>
<codeline lineno="115"><highlight class="normal"></highlight></codeline>
<codeline lineno="116"><highlight class="normal"></highlight><highlight class="comment">/*-------------------------------------------------------------------------*/</highlight></codeline>
<codeline lineno="126"><highlight class="comment">/*-------------------------------------------------------------------------*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="127" refid="stage_8h_1a46b8c1f1c37f48eb4261fc646e460478" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="stage_8c_1a46b8c1f1c37f48eb4261fc646e460478" kindref="member">FTI_InitStage</ref>(<sp/><ref refid="structFTIT__execution" kindref="compound">FTIT_execution</ref><sp/>*FTI_Exec,<sp/><ref refid="structFTIT__configuration" kindref="compound">FTIT_configuration</ref><sp/>*FTI_Conf,<sp/><ref refid="structFTIT__topology" kindref="compound">FTIT_topology</ref><sp/>*FTI_Topo<sp/>)<sp/></highlight></codeline>
<codeline lineno="128"><highlight class="normal">{</highlight></codeline>
<codeline lineno="129"><highlight class="normal"></highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!FTI_Conf-&gt;<ref refid="structFTIT__configuration_1ae6c297d0a3c6e122ee63085f2a365a30" kindref="member">stagingEnabled</ref><sp/>)<sp/>{</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;Staging<sp/>disabled,<sp/>invalid<sp/>call<sp/>to<sp/>&apos;FTI_InitStage&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a93eeeef1e283517099194859e3811ea3" kindref="member">FTI_WARN</ref><sp/>);</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="134"><highlight class="normal"></highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/>MPI_Type_contiguous(<sp/>2*<ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref><sp/>+<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">),<sp/>MPI_BYTE,<sp/>&amp;buf_t<sp/>);</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/>MPI_Type_commit(<sp/>&amp;buf_t<sp/>);</highlight></codeline>
<codeline lineno="137"><highlight class="normal"></highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>memory<sp/>window<sp/>size</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>win_size<sp/>=<sp/><ref refid="stage_8h_1ad88cc2c7bdc825945e93832f0d294ae9" kindref="member">FTI_SI_MAX_NUM</ref><sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint8_t)<sp/>*<sp/>!(FTI_Topo-&gt;<ref refid="structFTIT__topology_1ad44da908f25f84e0dc29086b77b37d8d" kindref="member">amIaHead</ref>);</highlight></codeline>
<codeline lineno="140"><highlight class="normal"></highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>requestIdx<sp/>array<sp/>size</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>arr_size<sp/>=<sp/><ref refid="stage_8h_1ad88cc2c7bdc825945e93832f0d294ae9" kindref="member">FTI_SI_MAX_NUM</ref><sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint32_t);</highlight></codeline>
<codeline lineno="143"><highlight class="normal"></highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>keep<sp/>ptr<sp/>to<sp/>enableStaging<sp/>flag<sp/>local<sp/>to<sp/>file</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/>enableStagingPtr<sp/>=<sp/>&amp;FTI_Conf-&gt;<ref refid="structFTIT__configuration_1ae6c297d0a3c6e122ee63085f2a365a30" kindref="member">stagingEnabled</ref>;</highlight></codeline>
<codeline lineno="146"><highlight class="normal"></highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>allocate<sp/>nbApproc<sp/>instances<sp/>of<sp/>Stage<sp/>info<sp/>for<sp/>heads<sp/>but<sp/>only<sp/>one<sp/>for<sp/>application<sp/>processes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>num<sp/>=<sp/>(<sp/>FTI_Topo-&gt;<ref refid="structFTIT__topology_1ad44da908f25f84e0dc29086b77b37d8d" kindref="member">amIaHead</ref><sp/>)<sp/>?<sp/>FTI_Topo-&gt;<ref refid="structFTIT__topology_1ab2b0c3441e7d43d243de5fefb4d8bf5d" kindref="member">nbApprocs</ref><sp/>:<sp/>1;</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/>FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref><sp/>=<sp/>calloc(<sp/>num,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="structFTIT__StageInfo" kindref="compound">FTIT_StageInfo</ref>)<sp/>);</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref><sp/>==<sp/>NULL<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8h_1a699d27699d4a8a419f9d643d8a74aa38" kindref="member">FTI_DISABLE_STAGING</ref>;</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>allocate<sp/>memory<sp/>for<sp/>&apos;FTI_Exec-&gt;stageInfo&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref><sp/>);</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="155"><highlight class="normal"></highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>allocate<sp/>request<sp/>idx<sp/>array<sp/>and<sp/>init<sp/>to<sp/>0x0.<sp/>Head<sp/>does<sp/>not<sp/>have<sp/>one<sp/>(would<sp/>double<sp/>memory<sp/>consumption).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>FTI_Topo-&gt;<ref refid="structFTIT__topology_1ad44da908f25f84e0dc29086b77b37d8d" kindref="member">amIaHead</ref><sp/>)<sp/>{</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>idxRequest<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>idxRequest<sp/>=<sp/>calloc(<sp/>1,<sp/>arr_size<sp/>);</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>idxRequest<sp/>==<sp/>NULL<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8h_1a699d27699d4a8a419f9d643d8a74aa38" kindref="member">FTI_DISABLE_STAGING</ref>;</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>allocate<sp/>memory<sp/>for<sp/>&apos;idxRequest&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref><sp/>);</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(<sp/>FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref><sp/>);</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="168"><highlight class="normal"></highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>create<sp/>node<sp/>communicator</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>NOTE:<sp/>head<sp/>is<sp/>assigned<sp/>rank<sp/>0.<sp/>This<sp/>is<sp/>important<sp/>in<sp/>order<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>to<sp/>access<sp/>the<sp/>stageInfo<sp/>array<sp/>at<sp/>the<sp/><sp/>head<sp/>rank<sp/>in<sp/>the<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>implemented<sp/>way<sp/>(array[app_rank-1],<sp/>app_ranks<sp/>=<sp/>1<sp/>-&gt;<sp/>nodeSize-1)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>key<sp/>=<sp/>(FTI_Topo-&gt;<ref refid="structFTIT__topology_1ad44da908f25f84e0dc29086b77b37d8d" kindref="member">amIaHead</ref>)<sp/>?<sp/>0<sp/>:<sp/>1;</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>FTI_Conf-&gt;<ref refid="structFTIT__configuration_1ae2196814ada1f4c5f8d78f34812bc4c1" kindref="member">test</ref><sp/>)<sp/>{</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>color<sp/>=<sp/>FTI_Topo-&gt;<ref refid="structFTIT__topology_1a1609f0606f6b7957f1e1b321e2fdb5af" kindref="member">nodeID</ref>;</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>MPI_Comm_split(<sp/>FTI_Exec-&gt;<ref refid="structFTIT__execution_1a9cbca3e2e49bb808bc73569db3fdecb2" kindref="member">globalComm</ref>,<sp/>color,<sp/>key,<sp/>&amp;FTI_Exec-&gt;<ref refid="structFTIT__execution_1abbb23501615ec870e650aad5f26b85d3" kindref="member">nodeComm</ref><sp/>);</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>MPI_Comm_split_type(<sp/>FTI_Exec-&gt;<ref refid="structFTIT__execution_1a9cbca3e2e49bb808bc73569db3fdecb2" kindref="member">globalComm</ref>,<sp/>MPI_COMM_TYPE_SHARED,<sp/>key,<sp/>MPI_INFO_NULL,<sp/>&amp;FTI_Exec-&gt;<ref refid="structFTIT__execution_1abbb23501615ec870e650aad5f26b85d3" kindref="member">nodeComm</ref><sp/>);<sp/></highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="180"><highlight class="normal"></highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>check<sp/>for<sp/>a<sp/>consistant<sp/>communicator<sp/>size</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>size;</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/>MPI_Comm_size(<sp/>FTI_Exec-&gt;<ref refid="structFTIT__execution_1abbb23501615ec870e650aad5f26b85d3" kindref="member">nodeComm</ref>,<sp/>&amp;size<sp/>);</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>size<sp/>!=<sp/>FTI_Topo-&gt;<ref refid="structFTIT__topology_1ab25ad2efd2edfe685bf3a5c8db4a4275" kindref="member">nodeSize</ref><sp/>)<sp/>{</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8h_1a699d27699d4a8a419f9d643d8a74aa38" kindref="member">FTI_DISABLE_STAGING</ref>;</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>str[<ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>];</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(str,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Wrong<sp/>size<sp/>(%d<sp/>!=<sp/>%d)<sp/>of<sp/>node<sp/>communicator,<sp/>disable<sp/>staging!&quot;</highlight><highlight class="normal">,<sp/>size,<sp/>FTI_Topo-&gt;<ref refid="structFTIT__topology_1ab25ad2efd2edfe685bf3a5c8db4a4275" kindref="member">nodeSize</ref><sp/>);</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(str,<sp/><ref refid="fti-intern_8h_1a93eeeef1e283517099194859e3811ea3" kindref="member">FTI_WARN</ref><sp/>);</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>MPI_Comm_free(<sp/>&amp;FTI_Exec-&gt;<ref refid="structFTIT__execution_1abbb23501615ec870e650aad5f26b85d3" kindref="member">nodeComm</ref><sp/>);</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(<sp/>FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref><sp/>);</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(<sp/>idxRequest<sp/>);</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="194"><highlight class="normal"></highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>store<sp/>rank</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/>MPI_Comm_rank(<sp/>FTI_Exec-&gt;<ref refid="structFTIT__execution_1abbb23501615ec870e650aad5f26b85d3" kindref="member">nodeComm</ref>,<sp/>&amp;FTI_Topo-&gt;<ref refid="structFTIT__topology_1a39761a9bc4ad6d0ca46b7ca82593c175" kindref="member">nodeRank</ref><sp/>);</highlight></codeline>
<codeline lineno="197"><highlight class="normal"></highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>store<sp/>head<sp/>rank<sp/>in<sp/>node<sp/>communicator</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>NOTE:<sp/>must(!!)<sp/>be<sp/>the<sp/>lowest<sp/>rank<sp/>number</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/>FTI_Topo-&gt;<ref refid="structFTIT__topology_1a01a744b0c9a84006be57cbca1f76abf5" kindref="member">headRankNode</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="201"><highlight class="normal"></highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>create<sp/>shared<sp/>memory<sp/>window</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>disp<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint8_t);</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/>MPI_Info<sp/>win_info;</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/>MPI_Info_create(&amp;win_info);</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/>MPI_Info_set(win_info,<sp/></highlight><highlight class="stringliteral">&quot;alloc_shared_noncontig&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;true&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/>MPI_Info_set(win_info,<sp/></highlight><highlight class="stringliteral">&quot;no_locks&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;true&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/>MPI_Win_allocate_shared(<sp/>win_size,<sp/>disp,<sp/>win_info,<sp/>FTI_Exec-&gt;<ref refid="structFTIT__execution_1abbb23501615ec870e650aad5f26b85d3" kindref="member">nodeComm</ref>,<sp/>&amp;status,<sp/>&amp;stageWin<sp/>);</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/>MPI_Info_free(&amp;win_info);</highlight></codeline>
<codeline lineno="210"><highlight class="normal"></highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>init<sp/>shared<sp/>memory<sp/>window<sp/>segments<sp/>to<sp/>0x0</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!(FTI_Topo-&gt;<ref refid="structFTIT__topology_1ad44da908f25f84e0dc29086b77b37d8d" kindref="member">amIaHead</ref>)<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>MPI_Aint<sp/>qsize;</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>qdisp;</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>MPI_Win_shared_query(<sp/>stageWin,<sp/>FTI_Topo-&gt;<ref refid="structFTIT__topology_1a39761a9bc4ad6d0ca46b7ca82593c175" kindref="member">nodeRank</ref>,<sp/>&amp;qsize,<sp/>&amp;qdisp,<sp/>&amp;status<sp/>);</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memset(<sp/>status,<sp/>0x0,<sp/>win_size<sp/>);</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="218"><highlight class="normal"></highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>create<sp/>stage<sp/>directory</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/>snprintf(FTI_Conf-&gt;<ref refid="structFTIT__configuration_1aaec373a5e13128f98021cc221e9fc426" kindref="member">stageDir</ref>,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>,<sp/></highlight><highlight class="stringliteral">&quot;%s/stage&quot;</highlight><highlight class="normal">,<sp/>FTI_Conf-&gt;<ref refid="structFTIT__configuration_1a016dadf213155c54820771627930cb68" kindref="member">localDir</ref>);</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(mkdir(FTI_Conf-&gt;<ref refid="structFTIT__configuration_1aaec373a5e13128f98021cc221e9fc426" kindref="member">stageDir</ref>,<sp/>0777)<sp/>==<sp/>-1)<sp/>{</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(errno<sp/>!=<sp/>EEXIST)<sp/>{</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8h_1a699d27699d4a8a419f9d643d8a74aa38" kindref="member">FTI_DISABLE_STAGING</ref>;</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>MPI_Win_free(<sp/>&amp;stageWin<sp/>);</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>MPI_Comm_free(<sp/>&amp;FTI_Exec-&gt;<ref refid="structFTIT__execution_1abbb23501615ec870e650aad5f26b85d3" kindref="member">nodeComm</ref><sp/>);</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(<sp/>FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref><sp/>);</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(<sp/>idxRequest<sp/>);</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(</highlight><highlight class="stringliteral">&quot;Cannot<sp/>create<sp/>stage<sp/>directory&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref>);</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="231"><highlight class="normal"></highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a8c1f0a06b877c18a7270d54c5e6039cf" kindref="member">FTI_SCES</ref>;</highlight></codeline>
<codeline lineno="233"><highlight class="normal"></highlight></codeline>
<codeline lineno="234"><highlight class="normal">}</highlight></codeline>
<codeline lineno="235"><highlight class="normal"></highlight></codeline>
<codeline lineno="236"><highlight class="normal"></highlight><highlight class="comment">/*-------------------------------------------------------------------------*/</highlight></codeline>
<codeline lineno="246"><highlight class="comment">/*-------------------------------------------------------------------------*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="247" refid="stage_8h_1acf6cca854e653c7c23d24011f5b3afc4" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="stage_8c_1acf6cca854e653c7c23d24011f5b3afc4" kindref="member">FTI_FinalizeStage</ref>(<sp/><ref refid="structFTIT__execution" kindref="compound">FTIT_execution</ref><sp/>*FTI_Exec,<sp/><ref refid="structFTIT__topology" kindref="compound">FTIT_topology</ref><sp/>*FTI_Topo,<sp/><ref refid="structFTIT__configuration" kindref="compound">FTIT_configuration</ref><sp/>*FTI_Conf<sp/>)<sp/></highlight></codeline>
<codeline lineno="248"><highlight class="normal">{</highlight></codeline>
<codeline lineno="249"><highlight class="normal"></highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>free<sp/>request<sp/>structures</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>NOTE:<sp/>the<sp/>heads<sp/>should<sp/>already<sp/>have<sp/>freed<sp/>all<sp/>the<sp/>ressources<sp/>during<sp/>the<sp/>execution.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>FTI_Topo-&gt;<ref refid="structFTIT__topology_1ad44da908f25f84e0dc29086b77b37d8d" kindref="member">amIaHead</ref><sp/>)<sp/>{</highlight></codeline>
<codeline lineno="253"><highlight class="normal"></highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(<sp/>;<sp/>i&lt;FTI_Topo-&gt;<ref refid="structFTIT__topology_1ab2b0c3441e7d43d243de5fefb4d8bf5d" kindref="member">nbApprocs</ref>;<sp/>++i<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nbRequest<sp/>=<sp/>FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>[i].<ref refid="structFTIT__StageInfo_1ab474f420ab576dde4f8375a403cacbcc" kindref="member">nbRequest</ref>;<sp/></highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>nbRequest<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(<sp/>FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>[i].<ref refid="structFTIT__StageInfo_1a4687045f1b5e679855bae7251421a82d" kindref="member">request</ref><sp/>);</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="261"><highlight class="normal"></highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="263"><highlight class="normal"></highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nbRequest<sp/>=<sp/>FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>-&gt;<ref refid="structFTIT__StageInfo_1ab474f420ab576dde4f8375a403cacbcc" kindref="member">nbRequest</ref>;</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structFTIT__StageAppInfo" kindref="compound">FTIT_StageAppInfo</ref><sp/>*ptr<sp/>=<sp/><ref refid="stage_8h_1ac2bb11c3f5f891e1e161b6b5c4f517e0" kindref="member">FTI_SI_APTR</ref>(<sp/>FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>-&gt;<ref refid="structFTIT__StageInfo_1a4687045f1b5e679855bae7251421a82d" kindref="member">request</ref><sp/>);</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>nbRequest<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<sp/>;<sp/>i&lt;nbRequest;<sp/>++i<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(<sp/>ptr[i].sendBuf<sp/>);</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(<sp/>ptr<sp/>);</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="273"><highlight class="normal"></highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="275"><highlight class="normal"></highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>ensure<sp/>that<sp/>before<sp/>removing<sp/>local<sp/>files,<sp/>all<sp/>is<sp/>on<sp/>the<sp/>PFS.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/>MPI_Barrier(<sp/>FTI_Exec-&gt;<ref refid="structFTIT__execution_1abbb23501615ec870e650aad5f26b85d3" kindref="member">nodeComm</ref><sp/>);</highlight></codeline>
<codeline lineno="278"><highlight class="normal"></highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>remove<sp/>staging<sp/>directory<sp/>and<sp/>all<sp/>the<sp/>staging<sp/>files.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="tools_8c_1ac4bfe54a9748e8915a5a43c17b334452" kindref="member">FTI_RmDir</ref>(FTI_Conf-&gt;<ref refid="structFTIT__configuration_1aaec373a5e13128f98021cc221e9fc426" kindref="member">stageDir</ref>,<sp/>FTI_Topo-&gt;<ref refid="structFTIT__topology_1ad44da908f25f84e0dc29086b77b37d8d" kindref="member">amIaHead</ref>);</highlight></codeline>
<codeline lineno="281"><highlight class="normal"></highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>ensure<sp/>that<sp/>before<sp/>removing<sp/>local<sp/>directory,<sp/>all<sp/>staging<sp/>files</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>are<sp/>removed.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/>MPI_Barrier(<sp/>FTI_Exec-&gt;<ref refid="structFTIT__execution_1a9cbca3e2e49bb808bc73569db3fdecb2" kindref="member">globalComm</ref><sp/>);</highlight></codeline>
<codeline lineno="285"><highlight class="normal"></highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>free<sp/>stage<sp/>info</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/>free(<sp/>FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref><sp/>);</highlight></codeline>
<codeline lineno="288"><highlight class="normal"></highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>free<sp/>idxRequest<sp/>field<sp/>array</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/>free(<sp/>idxRequest<sp/>);</highlight></codeline>
<codeline lineno="291"><highlight class="normal"></highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>free<sp/>window<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>NOTE:<sp/>this<sp/>also<sp/>releases<sp/>the<sp/>ressources<sp/>for<sp/>the<sp/>status<sp/>field<sp/>array</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/>MPI_Win_free(<sp/>&amp;stageWin<sp/>);</highlight></codeline>
<codeline lineno="295"><highlight class="normal"></highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>free<sp/>mpi<sp/>type</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/>MPI_Type_free(<sp/>&amp;buf_t<sp/>);</highlight></codeline>
<codeline lineno="298"><highlight class="normal"></highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>destroy<sp/>node<sp/>comm</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/>MPI_Comm_free(<sp/>&amp;FTI_Exec-&gt;<ref refid="structFTIT__execution_1abbb23501615ec870e650aad5f26b85d3" kindref="member">nodeComm</ref><sp/>);</highlight></codeline>
<codeline lineno="301"><highlight class="normal"></highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="stage_8h_1a699d27699d4a8a419f9d643d8a74aa38" kindref="member">FTI_DISABLE_STAGING</ref>;</highlight></codeline>
<codeline lineno="303"><highlight class="normal"></highlight></codeline>
<codeline lineno="304"><highlight class="normal">}</highlight></codeline>
<codeline lineno="305"><highlight class="normal"></highlight></codeline>
<codeline lineno="306"><highlight class="normal"></highlight></codeline>
<codeline lineno="307"><highlight class="normal"></highlight></codeline>
<codeline lineno="308"><highlight class="normal"></highlight></codeline>
<codeline lineno="309"><highlight class="normal"></highlight><highlight class="comment">/*-------------------------------------------------------------------------*/</highlight></codeline>
<codeline lineno="322"><highlight class="comment">/*-------------------------------------------------------------------------*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="323" refid="stage_8h_1add93ac9ae93c0bc729d2d68f1617341c" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="stage_8c_1add93ac9ae93c0bc729d2d68f1617341c" kindref="member">FTI_InitStageRequestApp</ref>(<sp/><ref refid="structFTIT__execution" kindref="compound">FTIT_execution</ref><sp/>*FTI_Exec,<sp/><ref refid="structFTIT__topology" kindref="compound">FTIT_topology</ref><sp/>*FTI_Topo,<sp/>uint32_t<sp/>ID<sp/>)<sp/></highlight></codeline>
<codeline lineno="324"><highlight class="normal">{</highlight></codeline>
<codeline lineno="325"><highlight class="normal"></highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!<ref refid="stage_8h_1aa81d3d5a8f468c54e216747e4937c77c" kindref="member">FTI_SI_ENABLED</ref><sp/>)<sp/>{</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;Staging<sp/>disabled!<sp/>Invalid<sp/>call<sp/>to<sp/>&apos;FTI_InitStageRequestApp&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a93eeeef1e283517099194859e3811ea3" kindref="member">FTI_WARN</ref><sp/>);</highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="330"><highlight class="normal"></highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>ID<sp/><sp/>&gt;<sp/><ref refid="stage_8h_1a1de8469fed78e2cafab8f93bd1b2b870" kindref="member">FTI_SI_MAX_ID</ref><sp/>)<sp/>{</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;passed<sp/>invalid<sp/>ID<sp/>to<sp/>&apos;FTI_InitStageRequestApp&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a93eeeef1e283517099194859e3811ea3" kindref="member">FTI_WARN</ref><sp/>);</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="335"><highlight class="normal"></highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*ptr<sp/>=<sp/>realloc(<sp/>FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>-&gt;<ref refid="structFTIT__StageInfo_1a4687045f1b5e679855bae7251421a82d" kindref="member">request</ref>,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="structFTIT__StageAppInfo" kindref="compound">FTIT_StageAppInfo</ref>)<sp/>*<sp/>(FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>-&gt;<ref refid="structFTIT__StageInfo_1ab474f420ab576dde4f8375a403cacbcc" kindref="member">nbRequest</ref>+1)<sp/>);</highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>ptr<sp/>==<sp/>NULL<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;failed<sp/>to<sp/>allocate<sp/>memory<sp/>for<sp/>&apos;FTI_Exec-&gt;stageInfo-&gt;request&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref><sp/>);</highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/>FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>-&gt;<ref refid="structFTIT__StageInfo_1a4687045f1b5e679855bae7251421a82d" kindref="member">request</ref><sp/>=<sp/>ptr;</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>idx<sp/>=<sp/>FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>-&gt;<ref refid="structFTIT__StageInfo_1ab474f420ab576dde4f8375a403cacbcc" kindref="member">nbRequest</ref>++;</highlight></codeline>
<codeline lineno="343"><highlight class="normal"></highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="stage_8h_1ac2bb11c3f5f891e1e161b6b5c4f517e0" kindref="member">FTI_SI_APTR</ref>(FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>-&gt;<ref refid="structFTIT__StageInfo_1a4687045f1b5e679855bae7251421a82d" kindref="member">request</ref>)[idx].mpiReq<sp/>=<sp/>MPI_REQUEST_NULL;</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="stage_8h_1ac2bb11c3f5f891e1e161b6b5c4f517e0" kindref="member">FTI_SI_APTR</ref>(FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>-&gt;<ref refid="structFTIT__StageInfo_1a4687045f1b5e679855bae7251421a82d" kindref="member">request</ref>)[idx].sendBuf<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="346"><highlight class="normal"></highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" kindref="member">FTI_SetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="fti_8h_1a4eb6ff54cf8f3c3149d42da30d23c498" kindref="member">FTI_SI_PEND</ref>,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>,<sp/>FTI_Topo-&gt;<ref refid="structFTIT__topology_1a39761a9bc4ad6d0ca46b7ca82593c175" kindref="member">nodeRank</ref><sp/>);</highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="stage_8c_1a35eb6e7616b99b2d7713d802327fe061" kindref="member">FTI_SetRequestField</ref>(<sp/>ID,<sp/><ref refid="stage_8h_1a885359d6b9b087342e57256a345e8ca0" kindref="member">FTI_SI_IALL</ref>,<sp/><ref refid="stage_8h_1a05ee3f86e04233d44812d99f1ce02f98a284a69ddc599e948a41d29045bf417a7" kindref="member">FTI_SIF_ALL</ref><sp/>);</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="stage_8c_1a35eb6e7616b99b2d7713d802327fe061" kindref="member">FTI_SetRequestField</ref>(<sp/>ID,<sp/>idx,<sp/><ref refid="stage_8h_1a05ee3f86e04233d44812d99f1ce02f98a45cfcc08399841b15ebd1df39e23cfa8" kindref="member">FTI_SIF_IDX</ref><sp/>);</highlight></codeline>
<codeline lineno="350"><highlight class="normal"></highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="stage_8h_1ac2bb11c3f5f891e1e161b6b5c4f517e0" kindref="member">FTI_SI_APTR</ref>(FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>-&gt;<ref refid="structFTIT__StageInfo_1a4687045f1b5e679855bae7251421a82d" kindref="member">request</ref>)[idx].ID<sp/>=<sp/>ID;</highlight></codeline>
<codeline lineno="352"><highlight class="normal"></highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a8c1f0a06b877c18a7270d54c5e6039cf" kindref="member">FTI_SCES</ref>;</highlight></codeline>
<codeline lineno="354"><highlight class="normal"></highlight></codeline>
<codeline lineno="355"><highlight class="normal">}</highlight></codeline>
<codeline lineno="356"><highlight class="normal"></highlight></codeline>
<codeline lineno="357"><highlight class="normal"></highlight><highlight class="comment">/*-------------------------------------------------------------------------*/</highlight></codeline>
<codeline lineno="372"><highlight class="comment">/*-------------------------------------------------------------------------*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="373" refid="stage_8h_1ae4b37a2f01edc58f583e828993eda152" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="stage_8c_1ae4b37a2f01edc58f583e828993eda152" kindref="member">FTI_InitStageRequestHead</ref>(<sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>lpath,<sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*rpath,<sp/><ref refid="structFTIT__execution" kindref="compound">FTIT_execution</ref><sp/>*FTI_Exec,<sp/></highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structFTIT__topology" kindref="compound">FTIT_topology</ref><sp/>*FTI_Topo,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>source,<sp/>uint32_t<sp/>ID<sp/>)<sp/></highlight></codeline>
<codeline lineno="375"><highlight class="normal">{</highlight></codeline>
<codeline lineno="376"><highlight class="normal"></highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!<ref refid="stage_8h_1aa81d3d5a8f468c54e216747e4937c77c" kindref="member">FTI_SI_ENABLED</ref><sp/>)<sp/>{</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;Staging<sp/>disabled,<sp/>invalid<sp/>call<sp/>to<sp/>&apos;FTI_InitStageRequestHead&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a93eeeef1e283517099194859e3811ea3" kindref="member">FTI_WARN</ref><sp/>);</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="381"><highlight class="normal"></highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>ID<sp/><sp/>&gt;<sp/><ref refid="stage_8h_1a1de8469fed78e2cafab8f93bd1b2b870" kindref="member">FTI_SI_MAX_ID</ref><sp/>)<sp/>{</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;passed<sp/>invalid<sp/>ID<sp/>to<sp/>&apos;FTI_InitStageRequestHead&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a93eeeef1e283517099194859e3811ea3" kindref="member">FTI_WARN</ref><sp/>);</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="386"><highlight class="normal"></highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*ptr<sp/>=<sp/>realloc(<sp/>FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>[source-1].<ref refid="structFTIT__StageInfo_1a4687045f1b5e679855bae7251421a82d" kindref="member">request</ref>,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="structFTIT__StageHeadInfo" kindref="compound">FTIT_StageHeadInfo</ref>)<sp/>*<sp/>(FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>[source-1].<ref refid="structFTIT__StageInfo_1ab474f420ab576dde4f8375a403cacbcc" kindref="member">nbRequest</ref>+1)<sp/>);</highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>ptr<sp/>==<sp/>NULL<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;failed<sp/>to<sp/>allocate<sp/>memory&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref><sp/>);</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structFTIT__StageInfo" kindref="compound">FTIT_StageInfo</ref><sp/>*si<sp/>=<sp/>&amp;(FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>[source-1]);<sp/></highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/>si-&gt;<ref refid="structFTIT__StageInfo_1a4687045f1b5e679855bae7251421a82d" kindref="member">request</ref><sp/>=<sp/>ptr;</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>idx<sp/>=<sp/>si-&gt;<ref refid="structFTIT__StageInfo_1ab474f420ab576dde4f8375a403cacbcc" kindref="member">nbRequest</ref>++;</highlight></codeline>
<codeline lineno="395"><highlight class="normal"></highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/>strncpy(<sp/><ref refid="stage_8h_1afa3c2ff5007ff6d4e2159653fa2bffbd" kindref="member">FTI_SI_HPTR</ref>(si-&gt;<ref refid="structFTIT__StageInfo_1a4687045f1b5e679855bae7251421a82d" kindref="member">request</ref>)[idx].lpath,<sp/>lpath,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref><sp/>);</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/>strncpy(<sp/><ref refid="stage_8h_1afa3c2ff5007ff6d4e2159653fa2bffbd" kindref="member">FTI_SI_HPTR</ref>(si-&gt;<ref refid="structFTIT__StageInfo_1a4687045f1b5e679855bae7251421a82d" kindref="member">request</ref>)[idx].rpath,<sp/>rpath,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref><sp/>);</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="stage_8h_1afa3c2ff5007ff6d4e2159653fa2bffbd" kindref="member">FTI_SI_HPTR</ref>(si-&gt;<ref refid="structFTIT__StageInfo_1a4687045f1b5e679855bae7251421a82d" kindref="member">request</ref>)[idx].offset<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="stage_8h_1afa3c2ff5007ff6d4e2159653fa2bffbd" kindref="member">FTI_SI_HPTR</ref>(si-&gt;<ref refid="structFTIT__StageInfo_1a4687045f1b5e679855bae7251421a82d" kindref="member">request</ref>)[idx].size<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="stage_8h_1afa3c2ff5007ff6d4e2159653fa2bffbd" kindref="member">FTI_SI_HPTR</ref>(si-&gt;<ref refid="structFTIT__StageInfo_1a4687045f1b5e679855bae7251421a82d" kindref="member">request</ref>)[idx].ID<sp/>=<sp/>ID;</highlight></codeline>
<codeline lineno="401"><highlight class="normal"></highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" kindref="member">FTI_SetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="fti_8h_1a1685329d73a38dd15caa9a9b5ffef36f" kindref="member">FTI_SI_ACTV</ref>,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="403"><highlight class="normal"></highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a8c1f0a06b877c18a7270d54c5e6039cf" kindref="member">FTI_SCES</ref>;</highlight></codeline>
<codeline lineno="405"><highlight class="normal"></highlight></codeline>
<codeline lineno="406"><highlight class="normal">}</highlight></codeline>
<codeline lineno="407"><highlight class="normal"></highlight></codeline>
<codeline lineno="408"><highlight class="normal"></highlight><highlight class="comment">/*-------------------------------------------------------------------------*/</highlight></codeline>
<codeline lineno="421"><highlight class="comment">/*-------------------------------------------------------------------------*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="422" refid="stage_8h_1a6e74aba3e759272cbdb8db6ccbb879f2" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="stage_8c_1a6e74aba3e759272cbdb8db6ccbb879f2" kindref="member">FTI_FreeStageRequest</ref>(<sp/><ref refid="structFTIT__execution" kindref="compound">FTIT_execution</ref><sp/>*FTI_Exec,<sp/><ref refid="structFTIT__topology" kindref="compound">FTIT_topology</ref><sp/>*FTI_Topo,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ID,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>source<sp/>)<sp/></highlight></codeline>
<codeline lineno="423"><highlight class="normal">{<sp/></highlight></codeline>
<codeline lineno="424"><highlight class="normal"></highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!<ref refid="stage_8h_1aa81d3d5a8f468c54e216747e4937c77c" kindref="member">FTI_SI_ENABLED</ref><sp/>)<sp/>{</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;Staging<sp/>disabled,<sp/>invalid<sp/>call<sp/>to<sp/>&apos;FTI_FreeStageRequest&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a93eeeef1e283517099194859e3811ea3" kindref="member">FTI_WARN</ref><sp/>);</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="429"><highlight class="normal"></highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!FTI_Topo-&gt;<ref refid="structFTIT__topology_1ad44da908f25f84e0dc29086b77b37d8d" kindref="member">amIaHead</ref><sp/>)<sp/>{</highlight></codeline>
<codeline lineno="431"><highlight class="normal"></highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>request<sp/>already<sp/>free,<sp/>just<sp/>return</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!<ref refid="stage_8c_1a1b29cd8c8e9446f2dbd8dafac4d07f05" kindref="member">FTI_GetRequestField</ref>(<sp/>ID,<sp/><ref refid="stage_8h_1a05ee3f86e04233d44812d99f1ce02f98a284a69ddc599e948a41d29045bf417a7" kindref="member">FTI_SIF_ALL</ref><sp/>)<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a8c1f0a06b877c18a7270d54c5e6039cf" kindref="member">FTI_SCES</ref>;</highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="436"><highlight class="normal"></highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>idx<sp/>=<sp/><ref refid="stage_8c_1a1b29cd8c8e9446f2dbd8dafac4d07f05" kindref="member">FTI_GetRequestField</ref>(<sp/>ID,<sp/><ref refid="stage_8h_1a05ee3f86e04233d44812d99f1ce02f98a45cfcc08399841b15ebd1df39e23cfa8" kindref="member">FTI_SIF_IDX</ref><sp/>);</highlight></codeline>
<codeline lineno="438"><highlight class="normal"></highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>type_size<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="stage_8h_1a4c4836845c1d522c6c26852c27d53a67" kindref="member">FTIT_StageAppInfo</ref>);</highlight></codeline>
<codeline lineno="440"><highlight class="normal"></highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>ptr<sp/>is<sp/>all<sp/>we<sp/>need</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structFTIT__StageAppInfo" kindref="compound">FTIT_StageAppInfo</ref><sp/>*ptr<sp/>=<sp/><ref refid="stage_8h_1ac2bb11c3f5f891e1e161b6b5c4f517e0" kindref="member">FTI_SI_APTR</ref>(FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>-&gt;<ref refid="structFTIT__StageInfo_1a4687045f1b5e679855bae7251421a82d" kindref="member">request</ref>);</highlight></codeline>
<codeline lineno="443"><highlight class="normal"></highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>last<sp/>element<sp/>in<sp/>array,<sp/>we<sp/>just<sp/>need<sp/>to<sp/>truncate<sp/>the<sp/>array.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>idx<sp/>==<sp/>(FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>-&gt;<ref refid="structFTIT__StageInfo_1ab474f420ab576dde4f8375a403cacbcc" kindref="member">nbRequest</ref>-1)<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*buf_ptr<sp/>=<sp/>ptr[idx].<ref refid="structFTIT__StageAppInfo_1a14defcc395518f8acfe4bd0990c5bc53" kindref="member">sendBuf</ref>;</highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ptr<sp/>=<sp/>realloc(<sp/>ptr,<sp/>type_size<sp/>*<sp/>(FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>-&gt;<ref refid="structFTIT__StageInfo_1ab474f420ab576dde4f8375a403cacbcc" kindref="member">nbRequest</ref>-1)<sp/>);</highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>(ptr<sp/>==<sp/>NULL)<sp/>&amp;&amp;<sp/>(FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>-&gt;<ref refid="structFTIT__StageInfo_1ab474f420ab576dde4f8375a403cacbcc" kindref="member">nbRequest</ref><sp/>&gt;<sp/>1)<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;failed<sp/>to<sp/>allocate<sp/>memory<sp/>for<sp/>&apos;ptr&apos;<sp/>in<sp/>&apos;FTI_FreeStageRequest&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref><sp/>);</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(<sp/>buf_ptr<sp/>);</highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>--FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>-&gt;<ref refid="structFTIT__StageInfo_1ab474f420ab576dde4f8375a403cacbcc" kindref="member">nbRequest</ref>;</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>-&gt;<ref refid="structFTIT__StageInfo_1a4687045f1b5e679855bae7251421a82d" kindref="member">request</ref><sp/>=<sp/>(FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>-&gt;<ref refid="structFTIT__StageInfo_1ab474f420ab576dde4f8375a403cacbcc" kindref="member">nbRequest</ref><sp/>==<sp/>0)<sp/>?<sp/>NULL<sp/>:<sp/>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*)ptr;</highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>not<sp/>last<sp/>element,<sp/>we<sp/>need<sp/>to<sp/>truncate<sp/>array<sp/>and<sp/>move<sp/>elements<sp/>(before<sp/>truncation)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*buf_ptr<sp/>=<sp/>ptr[idx].<ref refid="structFTIT__StageAppInfo_1a14defcc395518f8acfe4bd0990c5bc53" kindref="member">sendBuf</ref>;</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*dest<sp/>=<sp/>&amp;ptr[idx];</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*dest_cpy<sp/>=<sp/>malloc(<sp/>type_size<sp/>);</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>dest_cpy<sp/>==<sp/>NULL<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;failed<sp/>to<sp/>allocate<sp/>memory<sp/>for<sp/>&apos;dest_cpy&apos;<sp/>in<sp/>&apos;FTI_FreeStageRequest&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref><sp/>);</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(<sp/>dest_cpy,<sp/>dest,<sp/>type_size<sp/>);</highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*src<sp/>=<sp/>&amp;ptr[idx+1];</highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>mem_size<sp/>=<sp/>(FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>-&gt;<ref refid="structFTIT__StageInfo_1ab474f420ab576dde4f8375a403cacbcc" kindref="member">nbRequest</ref><sp/>-<sp/>(idx+1))<sp/>*<sp/>type_size;<sp/></highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memmove(<sp/>dest,<sp/>src,<sp/>mem_size<sp/>);</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ptr<sp/>=<sp/>realloc(<sp/>ptr,<sp/>type_size<sp/>*<sp/>(FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>-&gt;<ref refid="structFTIT__StageInfo_1ab474f420ab576dde4f8375a403cacbcc" kindref="member">nbRequest</ref>-1)<sp/>);</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>ptr<sp/>==<sp/>NULL<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;failed<sp/>to<sp/>allocate<sp/>memory<sp/>for<sp/>&apos;ptr&apos;<sp/>in<sp/>&apos;FTI_FreeStageRequest&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref><sp/>);</highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memmove(<sp/>src,<sp/>dest,<sp/>mem_size<sp/>);</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(<sp/>dest,<sp/>dest_cpy,<sp/>type_size<sp/>);</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(<sp/>dest_cpy);</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(<sp/>buf_ptr<sp/>);</highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(<sp/>dest_cpy<sp/>);</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>-&gt;<ref refid="structFTIT__StageInfo_1a4687045f1b5e679855bae7251421a82d" kindref="member">request</ref><sp/>=<sp/>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*)ptr;</highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>--FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>-&gt;<ref refid="structFTIT__StageInfo_1ab474f420ab576dde4f8375a403cacbcc" kindref="member">nbRequest</ref>;</highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>re-assign<sp/>the<sp/>correct<sp/>values</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>idx;</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(<sp/>;<sp/>i&lt;FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>-&gt;<ref refid="structFTIT__StageInfo_1ab474f420ab576dde4f8375a403cacbcc" kindref="member">nbRequest</ref>;<sp/>++i<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ID_tmp<sp/>=<sp/>ptr[i].<ref refid="structFTIT__StageAppInfo_1ab552cab69b2d5a223b44905728c6a4fc" kindref="member">ID</ref>;</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1a35eb6e7616b99b2d7713d802327fe061" kindref="member">FTI_SetRequestField</ref>(<sp/>ID_tmp,<sp/>i,<sp/><ref refid="stage_8h_1a05ee3f86e04233d44812d99f1ce02f98a45cfcc08399841b15ebd1df39e23cfa8" kindref="member">FTI_SIF_IDX</ref><sp/>);</highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="488"><highlight class="normal"></highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1a35eb6e7616b99b2d7713d802327fe061" kindref="member">FTI_SetRequestField</ref>(<sp/>ID,<sp/><ref refid="stage_8h_1a4cb2768f435a67134365643365af27f7" kindref="member">FTI_SI_NALL</ref>,<sp/><ref refid="stage_8h_1a05ee3f86e04233d44812d99f1ce02f98a284a69ddc599e948a41d29045bf417a7" kindref="member">FTI_SIF_ALL</ref><sp/>);</highlight></codeline>
<codeline lineno="490"><highlight class="normal"></highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="492"><highlight class="normal"></highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nbRequest<sp/>=<sp/>FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>[source-1].<ref refid="structFTIT__StageInfo_1ab474f420ab576dde4f8375a403cacbcc" kindref="member">nbRequest</ref>;</highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structFTIT__StageHeadInfo" kindref="compound">FTIT_StageHeadInfo</ref><sp/>*ptr<sp/>=<sp/><ref refid="stage_8h_1afa3c2ff5007ff6d4e2159653fa2bffbd" kindref="member">FTI_SI_HPTR</ref>(FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>[source-1].<ref refid="structFTIT__StageInfo_1a4687045f1b5e679855bae7251421a82d" kindref="member">request</ref>);</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>idx;</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>locate<sp/>idx,<sp/>heads<sp/>do<sp/>not<sp/>have<sp/>a<sp/>look-up<sp/>table</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(<sp/>idx=0;<sp/>idx&lt;nbRequest;<sp/>++idx<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(ptr-&gt;<ref refid="structFTIT__StageHeadInfo_1a35d59db5793147287eed4e692878da0e" kindref="member">ID</ref><sp/>==<sp/>ID)<sp/>{</highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>idx<sp/>==<sp/>nbRequest<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(</highlight><highlight class="stringliteral">&quot;invalid<sp/>ID!<sp/>Failed<sp/>to<sp/>free<sp/>stage<sp/>request<sp/>meta<sp/>info<sp/>(FTI<sp/>head<sp/>process).&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a93eeeef1e283517099194859e3811ea3" kindref="member">FTI_WARN</ref>);</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="506"><highlight class="normal"></highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>type_size<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="stage_8h_1a0ace2903bf808b32a8bc91aae9fb93a2" kindref="member">FTIT_StageHeadInfo</ref>);</highlight></codeline>
<codeline lineno="508"><highlight class="normal"></highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>last<sp/>element<sp/>in<sp/>array,<sp/>we<sp/>just<sp/>need<sp/>to<sp/>truncate<sp/>the<sp/>array.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>idx<sp/>==<sp/>(nbRequest-1)<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ptr<sp/>=<sp/>realloc(<sp/>ptr,<sp/>type_size<sp/>*<sp/>(nbRequest-1)<sp/>);</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>(ptr<sp/>==<sp/>NULL)<sp/>&amp;&amp;<sp/>(nbRequest<sp/>&gt;<sp/>1)<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;failed<sp/>to<sp/>allocate<sp/>memory<sp/>for<sp/>&apos;ptr&apos;<sp/>in<sp/>&apos;FTI_FreeStageRequest&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref><sp/>);</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>--FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>[source-1].<ref refid="structFTIT__StageInfo_1ab474f420ab576dde4f8375a403cacbcc" kindref="member">nbRequest</ref>;</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>[source-1].<ref refid="structFTIT__StageInfo_1a4687045f1b5e679855bae7251421a82d" kindref="member">request</ref><sp/>=<sp/>(FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>[source-1].<ref refid="structFTIT__StageInfo_1ab474f420ab576dde4f8375a403cacbcc" kindref="member">nbRequest</ref><sp/>==<sp/>0)<sp/>?<sp/>NULL<sp/>:<sp/>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*)ptr;</highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight></codeline>
<codeline lineno="519"><highlight class="normal"></highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>not<sp/>last<sp/>element,<sp/>we<sp/>need<sp/>to<sp/>truncate<sp/>array<sp/>and<sp/>move<sp/>elements<sp/>(before<sp/>truncation)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*dest<sp/>=<sp/>&amp;(ptr[idx]);</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*dest_cpy<sp/>=<sp/>malloc(<sp/>type_size<sp/>);</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>dest_cpy<sp/>==<sp/>NULL<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;failed<sp/>to<sp/>allocate<sp/>memory<sp/>for<sp/>&apos;dest_cpy&apos;<sp/>in<sp/>&apos;FTI_FreeStageRequest&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref><sp/>);</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(<sp/>dest_cpy,<sp/>dest,<sp/>type_size<sp/>);</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*src<sp/>=<sp/>&amp;(ptr[idx+1]);</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>mem_size<sp/>=<sp/>(nbRequest<sp/>-<sp/>(idx+1))<sp/>*<sp/>type_size;<sp/></highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memmove(<sp/>dest,<sp/>src,<sp/>mem_size<sp/>);</highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ptr<sp/>=<sp/>realloc(<sp/>ptr,<sp/>type_size<sp/>*<sp/>(nbRequest-1)<sp/>);</highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>ptr<sp/>==<sp/>NULL<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;failed<sp/>to<sp/>allocate<sp/>memory<sp/>for<sp/>&apos;ptr&apos;<sp/>in<sp/>&apos;FTI_FreeStageRequest&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref><sp/>);</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memmove(<sp/>src,<sp/>dest,<sp/>mem_size<sp/>);</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(<sp/>dest,<sp/>dest_cpy,<sp/>type_size<sp/>);</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(<sp/>dest_cpy);</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(<sp/>dest_cpy);</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>[source-1].<ref refid="structFTIT__StageInfo_1a4687045f1b5e679855bae7251421a82d" kindref="member">request</ref><sp/>=<sp/>ptr;</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>--FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>[source-1].<ref refid="structFTIT__StageInfo_1ab474f420ab576dde4f8375a403cacbcc" kindref="member">nbRequest</ref>;</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="544"><highlight class="normal"></highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="546"><highlight class="normal"></highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a8c1f0a06b877c18a7270d54c5e6039cf" kindref="member">FTI_SCES</ref>;</highlight></codeline>
<codeline lineno="548"><highlight class="normal"></highlight></codeline>
<codeline lineno="549"><highlight class="normal">}</highlight></codeline>
<codeline lineno="550"><highlight class="normal"></highlight></codeline>
<codeline lineno="551"><highlight class="normal"></highlight><highlight class="comment">/*-------------------------------------------------------------------------*/</highlight></codeline>
<codeline lineno="558"><highlight class="comment">/*-------------------------------------------------------------------------*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="559" refid="stage_8h_1a0c5a2182e719ef3336289bd24f8fd312" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="stage_8c_1a0c5a2182e719ef3336289bd24f8fd312" kindref="member">FTI_GetRequestIdx</ref>(<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ID<sp/>)<sp/></highlight></codeline>
<codeline lineno="560"><highlight class="normal">{</highlight></codeline>
<codeline lineno="561"><highlight class="normal"></highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/><ref refid="stage_8c_1a1b29cd8c8e9446f2dbd8dafac4d07f05" kindref="member">FTI_GetRequestField</ref>(<sp/>ID,<sp/><ref refid="stage_8h_1a05ee3f86e04233d44812d99f1ce02f98a284a69ddc599e948a41d29045bf417a7" kindref="member">FTI_SIF_ALL</ref><sp/>)<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="stage_8c_1a1b29cd8c8e9446f2dbd8dafac4d07f05" kindref="member">FTI_GetRequestField</ref>(<sp/>ID,<sp/><ref refid="stage_8h_1a05ee3f86e04233d44812d99f1ce02f98a45cfcc08399841b15ebd1df39e23cfa8" kindref="member">FTI_SIF_IDX</ref><sp/>);</highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="567"><highlight class="normal">}</highlight></codeline>
<codeline lineno="568"><highlight class="normal"></highlight></codeline>
<codeline lineno="569"><highlight class="normal"></highlight><highlight class="comment">/*-------------------------------------------------------------------------*/</highlight></codeline>
<codeline lineno="583"><highlight class="comment">/*-------------------------------------------------------------------------*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="584" refid="stage_8h_1a182f1f60a5374160a724cee0034c572d" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="stage_8c_1a182f1f60a5374160a724cee0034c572d" kindref="member">FTI_SyncStage</ref>(<sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>lpath,<sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*rpath,<sp/><ref refid="structFTIT__execution" kindref="compound">FTIT_execution</ref><sp/>*FTI_Exec,<sp/></highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structFTIT__topology" kindref="compound">FTIT_topology</ref><sp/>*FTI_Topo,<sp/><ref refid="structFTIT__configuration" kindref="compound">FTIT_configuration</ref><sp/>*FTI_Conf,<sp/>uint32_t<sp/>ID<sp/>)<sp/></highlight></codeline>
<codeline lineno="586"><highlight class="normal">{</highlight></codeline>
<codeline lineno="587"><highlight class="normal"></highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!<ref refid="stage_8h_1aa81d3d5a8f468c54e216747e4937c77c" kindref="member">FTI_SI_ENABLED</ref><sp/>)<sp/>{</highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;Staging<sp/>disabled,<sp/>invalid<sp/>call<sp/>to<sp/>&apos;FTI_SyncStage&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a93eeeef1e283517099194859e3811ea3" kindref="member">FTI_WARN</ref><sp/>);</highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="592"><highlight class="normal"></highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>errstr[<ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>];</highlight></codeline>
<codeline lineno="594"><highlight class="normal"></highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>source<sp/>=<sp/>FTI_Topo-&gt;<ref refid="structFTIT__topology_1a39761a9bc4ad6d0ca46b7ca82593c175" kindref="member">nodeRank</ref>;</highlight></codeline>
<codeline lineno="596"><highlight class="normal"></highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>consistency</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" kindref="member">FTI_SetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="fti_8h_1a1685329d73a38dd15caa9a9b5ffef36f" kindref="member">FTI_SI_ACTV</ref>,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="599"><highlight class="normal"></highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>set<sp/>buffer<sp/>size<sp/>for<sp/>the<sp/>file<sp/>data<sp/>transfer</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>bs<sp/>=<sp/>FTI_Conf-&gt;<ref refid="structFTIT__configuration_1a090ca8bd3b6c624641bad1cb94678167" kindref="member">transferSize</ref>;</highlight></codeline>
<codeline lineno="602"><highlight class="normal"></highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>check<sp/>local<sp/>file<sp/>and<sp/>get<sp/>file<sp/>size</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">stat<sp/>st;</highlight></codeline>
<codeline lineno="605"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/><sp/>stat(<sp/>lpath,<sp/>&amp;st<sp/>)<sp/>==<sp/>-1<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" kindref="member">FTI_SetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="fti_8h_1a8b63f0cd5d9aa9417c3d3ec5a703ca1b" kindref="member">FTI_SI_FAIL</ref>,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="607"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(<sp/>errstr,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Could<sp/>not<sp/>stat<sp/>the<sp/>local<sp/>file<sp/>(&apos;%s&apos;)<sp/>for<sp/>staging&quot;</highlight><highlight class="normal">,<sp/>lpath<sp/>);</highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/>errstr,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref><sp/>);</highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="610"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>!S_ISREG(st.st_mode)<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" kindref="member">FTI_SetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="fti_8h_1a8b63f0cd5d9aa9417c3d3ec5a703ca1b" kindref="member">FTI_SI_FAIL</ref>,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(<sp/>errstr,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>,<sp/></highlight><highlight class="stringliteral">&quot;&apos;%s&apos;<sp/>is<sp/>not<sp/>a<sp/>regular<sp/>file,<sp/>staging<sp/>failed.&quot;</highlight><highlight class="normal">,<sp/>lpath<sp/>);</highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/>errstr,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref><sp/>);</highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>errno<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="618"><highlight class="normal"></highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/>off_t<sp/>eof<sp/>=<sp/>st.st_size;</highlight></codeline>
<codeline lineno="620"><highlight class="normal"></highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>duplicate<sp/>rpath<sp/>(dirname<sp/>modifies<sp/>its<sp/>argument!)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*dirc<sp/>=<sp/>strdup(rpath);</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>dirc<sp/>==<sp/>NULL<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" kindref="member">FTI_SetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="fti_8h_1a8b63f0cd5d9aa9417c3d3ec5a703ca1b" kindref="member">FTI_SI_FAIL</ref>,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;failed<sp/>to<sp/>allocate<sp/>memory<sp/>for<sp/>&apos;dirc&apos;<sp/>in<sp/>&apos;FTI_HandleStageRequest&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref><sp/>);</highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*dir_name<sp/>=<sp/>dirname(dirc);</highlight></codeline>
<codeline lineno="629"><highlight class="normal"></highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>check<sp/>if<sp/>remote<sp/>directory<sp/>exists</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>stat(<sp/>dir_name,<sp/>&amp;st<sp/>)<sp/>!=<sp/>0<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>errno<sp/>==<sp/>ENOENT<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" kindref="member">FTI_SetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="fti_8h_1a8b63f0cd5d9aa9417c3d3ec5a703ca1b" kindref="member">FTI_SI_FAIL</ref>,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(<sp/>errstr,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>,<sp/></highlight><highlight class="stringliteral">&quot;The<sp/>directory<sp/>&apos;%s&apos;<sp/>does<sp/>not<sp/>exist,<sp/>staging<sp/>failed.&quot;</highlight><highlight class="normal">,<sp/>dir_name<sp/>);</highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/>errstr,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref><sp/>);</highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" kindref="member">FTI_SetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="fti_8h_1a8b63f0cd5d9aa9417c3d3ec5a703ca1b" kindref="member">FTI_SI_FAIL</ref>,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(<sp/>errstr,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>stat<sp/>&apos;%s&apos;,<sp/>abort<sp/>staging.&quot;</highlight><highlight class="normal">,<sp/>dir_name<sp/>);</highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/>errstr,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref><sp/>);</highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>check<sp/>if<sp/>it<sp/>is<sp/>indeed<sp/>a<sp/>directory</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!S_ISDIR(st.st_mode)<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" kindref="member">FTI_SetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="fti_8h_1a8b63f0cd5d9aa9417c3d3ec5a703ca1b" kindref="member">FTI_SI_FAIL</ref>,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(<sp/>errstr,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>,<sp/></highlight><highlight class="stringliteral">&quot;&apos;%s&apos;<sp/>is<sp/>not<sp/>a<sp/>directory,<sp/>abort<sp/>staging.&quot;</highlight><highlight class="normal">,<sp/>dir_name<sp/>);</highlight></codeline>
<codeline lineno="648"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/>errstr,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref><sp/>);</highlight></codeline>
<codeline lineno="649"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="651"><highlight class="normal"></highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/>free(<sp/>dirc<sp/>);</highlight></codeline>
<codeline lineno="653"><highlight class="normal"></highlight></codeline>
<codeline lineno="654"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>check<sp/>if<sp/>remote<sp/>file<sp/>already<sp/>exist</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/><sp/>stat(<sp/>rpath,<sp/>&amp;st<sp/>)<sp/>==<sp/>0<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>S_ISREG(st.st_mode)<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>warnstr[<ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>];</highlight></codeline>
<codeline lineno="658"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(<sp/>warnstr,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>,<sp/></highlight><highlight class="stringliteral">&quot;remote<sp/>file<sp/>&apos;%s&apos;<sp/>already<sp/>exists,<sp/>attempt<sp/>to<sp/>overwrite.&quot;</highlight><highlight class="normal">,<sp/>rpath<sp/>);</highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/>warnstr,<sp/><ref refid="fti-intern_8h_1a93eeeef1e283517099194859e3811ea3" kindref="member">FTI_WARN</ref><sp/>);</highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>open<sp/>local<sp/>file</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>fd_local<sp/>=<sp/>open(<sp/>lpath,<sp/>O_RDONLY<sp/>);</highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>fd_local<sp/>==<sp/>-1<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" kindref="member">FTI_SetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="fti_8h_1a8b63f0cd5d9aa9417c3d3ec5a703ca1b" kindref="member">FTI_SI_FAIL</ref>,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(</highlight><highlight class="stringliteral">&quot;Could<sp/>not<sp/>open<sp/>the<sp/>local<sp/>file<sp/>for<sp/>staging&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref>);</highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="668"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>open<sp/>file<sp/>on<sp/>remote<sp/>fs</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="670"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>fd_global<sp/>=<sp/>open(<sp/>rpath,<sp/>O_WRONLY|O_CREAT,<sp/>(mode_t)<sp/>0600<sp/>);</highlight></codeline>
<codeline lineno="671"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>fd_global<sp/>==<sp/>-1<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" kindref="member">FTI_SetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="fti_8h_1a8b63f0cd5d9aa9417c3d3ec5a703ca1b" kindref="member">FTI_SI_FAIL</ref>,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(</highlight><highlight class="stringliteral">&quot;Could<sp/>not<sp/>open<sp/>the<sp/>destination<sp/>file<sp/>for<sp/>staging&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref>);</highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>close(<sp/>fd_local<sp/>);</highlight></codeline>
<codeline lineno="675"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="676"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="677"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>allocate<sp/>buffer</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*buf<sp/>=<sp/>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*)<sp/>malloc(<sp/>bs<sp/>);</highlight></codeline>
<codeline lineno="679"><highlight class="normal"></highlight></codeline>
<codeline lineno="680"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>move<sp/>file<sp/>to<sp/>destination</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/><sp/><sp/>off_t<sp/>pos<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/><sp/><sp/>ssize_t<sp/>read_bytes,<sp/>write_bytes;</highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>buf_bytes;</highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal">(<sp/>pos<sp/>&lt;<sp/>eof<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>buf_bytes<sp/>=<sp/>(<sp/>(eof<sp/>-<sp/>pos)<sp/>&lt;<sp/>bs<sp/>)<sp/>?<sp/>eof<sp/>-<sp/>pos<sp/>:<sp/>bs;</highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>the<sp/>case<sp/>we<sp/>have<sp/>written<sp/>less<sp/>then<sp/>we<sp/>have<sp/>read</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>lseek(<sp/>fd_local,<sp/>pos,<sp/>SEEK_SET<sp/>)<sp/>==<sp/>-1<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(<sp/>errstr,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>,<sp/></highlight><highlight class="stringliteral">&quot;unable<sp/>to<sp/>seek<sp/>in<sp/>&apos;%s&apos;.&quot;</highlight><highlight class="normal">,<sp/>lpath<sp/>);</highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/>errstr,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref><sp/>);</highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>errno<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(<sp/>buf<sp/>);</highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>close(<sp/>fd_local<sp/>);</highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>close(<sp/>fd_global<sp/>);</highlight></codeline>
<codeline lineno="694"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>(read_bytes<sp/>=<sp/>read(<sp/>fd_local,<sp/>buf,<sp/>buf_bytes<sp/>))<sp/>==<sp/>-1<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" kindref="member">FTI_SetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="fti_8h_1a8b63f0cd5d9aa9417c3d3ec5a703ca1b" kindref="member">FTI_SI_FAIL</ref>,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(<sp/>errstr,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>,<sp/></highlight><highlight class="stringliteral">&quot;unable<sp/>to<sp/>read<sp/>from<sp/>&apos;%s&apos;.&quot;</highlight><highlight class="normal">,<sp/>lpath<sp/>);</highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/>errstr,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref><sp/>);</highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>errno<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(<sp/>buf<sp/>);</highlight></codeline>
<codeline lineno="702"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>close(<sp/>fd_local<sp/>);</highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>close(<sp/>fd_global<sp/>);</highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>(write_bytes<sp/>=<sp/>write(<sp/>fd_global,<sp/>buf,<sp/>read_bytes<sp/>))<sp/>==<sp/>-1<sp/>)<sp/>{<sp/><sp/></highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" kindref="member">FTI_SetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="fti_8h_1a8b63f0cd5d9aa9417c3d3ec5a703ca1b" kindref="member">FTI_SI_FAIL</ref>,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(<sp/>errstr,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>,<sp/></highlight><highlight class="stringliteral">&quot;unable<sp/>to<sp/>write<sp/>to<sp/>&apos;%s&apos;.&quot;</highlight><highlight class="normal">,<sp/>rpath<sp/>);</highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/>errstr,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref><sp/>);</highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>errno<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(<sp/>buf<sp/>);</highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>close(<sp/>fd_local<sp/>);</highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>close(<sp/>fd_global<sp/>);</highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pos<sp/>+=<sp/>write_bytes;</highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="718"><highlight class="normal"></highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>deallocate<sp/>buffer<sp/>and<sp/>close<sp/>file<sp/>descriptors</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/><sp/><sp/>free(<sp/>buf<sp/>);</highlight></codeline>
<codeline lineno="721"><highlight class="normal"><sp/><sp/><sp/><sp/>close(<sp/>fd_local<sp/>);</highlight></codeline>
<codeline lineno="722"><highlight class="normal"><sp/><sp/><sp/><sp/>fsync(<sp/>fd_global<sp/>);</highlight></codeline>
<codeline lineno="723"><highlight class="normal"><sp/><sp/><sp/><sp/>close(<sp/>fd_global<sp/>);</highlight></codeline>
<codeline lineno="724"><highlight class="normal"></highlight></codeline>
<codeline lineno="725"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>remove(<sp/>lpath<sp/>)<sp/>==<sp/>-1<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="726"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(<sp/>errstr,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Could<sp/>not<sp/>remove<sp/>local<sp/>file<sp/>&apos;%s&apos;.&quot;</highlight><highlight class="normal">,<sp/>lpath<sp/>);</highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/>errstr,<sp/><ref refid="fti-intern_8h_1a93eeeef1e283517099194859e3811ea3" kindref="member">FTI_WARN</ref><sp/>);</highlight></codeline>
<codeline lineno="728"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>errno<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="729"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="730"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="731"><highlight class="normal"></highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" kindref="member">FTI_SetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="fti_8h_1a93cefc8dced9cb5c63c45708ef89694b" kindref="member">FTI_SI_SCES</ref>,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="733"><highlight class="normal"></highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a8c1f0a06b877c18a7270d54c5e6039cf" kindref="member">FTI_SCES</ref>;</highlight></codeline>
<codeline lineno="735"><highlight class="normal"></highlight></codeline>
<codeline lineno="736"><highlight class="normal">}</highlight></codeline>
<codeline lineno="737"><highlight class="normal"></highlight></codeline>
<codeline lineno="738"><highlight class="normal"></highlight><highlight class="comment">/*-------------------------------------------------------------------------*/</highlight></codeline>
<codeline lineno="753"><highlight class="comment">/*-------------------------------------------------------------------------*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="754" refid="stage_8h_1a61d6e550d9f80163986a523bc8f2d33d" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="stage_8c_1a61d6e550d9f80163986a523bc8f2d33d" kindref="member">FTI_AsyncStage</ref>(<sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*lpath,<sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*rpath,<sp/><ref refid="structFTIT__configuration" kindref="compound">FTIT_configuration</ref><sp/>*FTI_Conf,<sp/></highlight></codeline>
<codeline lineno="755"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structFTIT__execution" kindref="compound">FTIT_execution</ref><sp/>*FTI_Exec,<sp/><ref refid="structFTIT__topology" kindref="compound">FTIT_topology</ref><sp/>*FTI_Topo,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ID<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="756"><highlight class="normal"></highlight></codeline>
<codeline lineno="757"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!<ref refid="stage_8h_1aa81d3d5a8f468c54e216747e4937c77c" kindref="member">FTI_SI_ENABLED</ref><sp/>)<sp/>{</highlight></codeline>
<codeline lineno="758"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;Staging<sp/>disabled,<sp/>invalid<sp/>call<sp/>to<sp/>&apos;FTI_AsyncStage&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a93eeeef1e283517099194859e3811ea3" kindref="member">FTI_WARN</ref><sp/>);</highlight></codeline>
<codeline lineno="759"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="760"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="761"><highlight class="normal"></highlight></codeline>
<codeline lineno="762"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>idx<sp/>=<sp/><ref refid="stage_8c_1a1b29cd8c8e9446f2dbd8dafac4d07f05" kindref="member">FTI_GetRequestField</ref>(<sp/>ID,<sp/><ref refid="stage_8h_1a05ee3f86e04233d44812d99f1ce02f98a45cfcc08399841b15ebd1df39e23cfa8" kindref="member">FTI_SIF_IDX</ref><sp/>);</highlight></codeline>
<codeline lineno="763"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>serialize<sp/>request<sp/>before<sp/>sending<sp/>to<sp/>the<sp/>head</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="764"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*buf_ser<sp/>=<sp/>malloc<sp/>(<sp/>2*<ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref><sp/>+<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)<sp/>);</highlight></codeline>
<codeline lineno="765"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>buf_ser<sp/>==<sp/>NULL<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="766"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(</highlight><highlight class="stringliteral">&quot;failed<sp/>to<sp/>allocate<sp/>memory<sp/>for<sp/>&apos;buf_ser&apos;<sp/>in<sp/>FTI_AsyncStage&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref><sp/>);</highlight></codeline>
<codeline lineno="767"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="768"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>pos<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="770"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(<sp/>buf_ser,<sp/>lpath,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref><sp/>);<sp/><sp/><sp/></highlight></codeline>
<codeline lineno="771"><highlight class="normal"><sp/><sp/><sp/><sp/>pos<sp/>+=<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>;</highlight></codeline>
<codeline lineno="772"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(<sp/>buf_ser<sp/>+<sp/>pos,<sp/>rpath,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref><sp/>);<sp/><sp/><sp/></highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/><sp/><sp/>pos<sp/>+=<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>;</highlight></codeline>
<codeline lineno="774"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(<sp/>buf_ser<sp/>+<sp/>pos,<sp/>&amp;ID,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)<sp/>);<sp/><sp/><sp/></highlight></codeline>
<codeline lineno="775"><highlight class="normal"><sp/><sp/><sp/><sp/>pos<sp/>+=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(int);</highlight></codeline>
<codeline lineno="776"><highlight class="normal"></highlight></codeline>
<codeline lineno="777"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>send<sp/>request<sp/>to<sp/>head</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="778"><highlight class="normal"><sp/><sp/><sp/><sp/>MPI_Request<sp/>*mpiReq<sp/>=<sp/>&amp;(<ref refid="stage_8h_1ac2bb11c3f5f891e1e161b6b5c4f517e0" kindref="member">FTI_SI_APTR</ref>(FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>-&gt;<ref refid="structFTIT__StageInfo_1a4687045f1b5e679855bae7251421a82d" kindref="member">request</ref>)[idx].mpiReq);</highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/><sp/><sp/>MPI_Isend(<sp/>buf_ser,<sp/>1,<sp/>buf_t,<sp/>FTI_Topo-&gt;<ref refid="structFTIT__topology_1a01a744b0c9a84006be57cbca1f76abf5" kindref="member">headRankNode</ref>,<sp/>FTI_Conf-&gt;<ref refid="structFTIT__configuration_1a6f1b79f826e4ced2ac4faad025cc6c5d" kindref="member">stageTag</ref>,<sp/>FTI_Exec-&gt;<ref refid="structFTIT__execution_1abbb23501615ec870e650aad5f26b85d3" kindref="member">nodeComm</ref>,<sp/>mpiReq<sp/>);</highlight></codeline>
<codeline lineno="780"><highlight class="normal"></highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>keep<sp/>send<sp/>buffer<sp/>until<sp/>it<sp/>may<sp/>be<sp/>freed<sp/>(MPI_Test<sp/>check<sp/>in<sp/>&apos;FTI_GetStageStatus&apos;)<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="782"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="stage_8h_1ac2bb11c3f5f891e1e161b6b5c4f517e0" kindref="member">FTI_SI_APTR</ref>(FTI_Exec-&gt;<ref refid="structFTIT__execution_1a375349b5e9e834a60929b760443e9425" kindref="member">stageInfo</ref>-&gt;<ref refid="structFTIT__StageInfo_1a4687045f1b5e679855bae7251421a82d" kindref="member">request</ref>)[idx].sendBuf<sp/>=<sp/>buf_ser;</highlight></codeline>
<codeline lineno="783"><highlight class="normal"></highlight></codeline>
<codeline lineno="784"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a8c1f0a06b877c18a7270d54c5e6039cf" kindref="member">FTI_SCES</ref>;</highlight></codeline>
<codeline lineno="785"><highlight class="normal">}</highlight></codeline>
<codeline lineno="786"><highlight class="normal"></highlight></codeline>
<codeline lineno="787"><highlight class="normal"></highlight><highlight class="comment">/*-------------------------------------------------------------------------*/</highlight></codeline>
<codeline lineno="798"><highlight class="comment">/*-------------------------------------------------------------------------*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="799" refid="stage_8h_1a7e59d3bafaa826d69a91493c80a417e3" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="stage_8c_1a7e59d3bafaa826d69a91493c80a417e3" kindref="member">FTI_HandleStageRequest</ref>(<ref refid="structFTIT__configuration" kindref="compound">FTIT_configuration</ref>*<sp/>FTI_Conf,<sp/><ref refid="structFTIT__execution" kindref="compound">FTIT_execution</ref>*<sp/>FTI_Exec,</highlight></codeline>
<codeline lineno="800"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structFTIT__topology" kindref="compound">FTIT_topology</ref>*<sp/>FTI_Topo,<sp/><ref refid="structFTIT__checkpoint" kindref="compound">FTIT_checkpoint</ref>*<sp/>FTI_Ckpt,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>source)</highlight></codeline>
<codeline lineno="801"><highlight class="normal">{<sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="802"><highlight class="normal"></highlight></codeline>
<codeline lineno="803"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!<ref refid="stage_8h_1aa81d3d5a8f468c54e216747e4937c77c" kindref="member">FTI_SI_ENABLED</ref><sp/>)<sp/>{</highlight></codeline>
<codeline lineno="804"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;Staging<sp/>disabled,<sp/>invalid<sp/>call<sp/>to<sp/>&apos;FTI_HandleStageRequest&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a93eeeef1e283517099194859e3811ea3" kindref="member">FTI_WARN</ref><sp/>);</highlight></codeline>
<codeline lineno="805"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="806"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="807"><highlight class="normal"></highlight></codeline>
<codeline lineno="808"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>errstr[<ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>];</highlight></codeline>
<codeline lineno="809"><highlight class="normal"></highlight></codeline>
<codeline lineno="810"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>buf_ser_size<sp/>=<sp/>2*<ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref><sp/>+<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(int);</highlight></codeline>
<codeline lineno="811"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*buf_ser<sp/>=<sp/>malloc<sp/>(<sp/>buf_ser_size<sp/>);</highlight></codeline>
<codeline lineno="812"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>buf_ser<sp/>==<sp/>NULL<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="813"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;failed<sp/>to<sp/>allocate<sp/>memory<sp/>for<sp/>&apos;buf_ser&apos;<sp/>in<sp/>FTI_HandleStageRequest&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref><sp/>);</highlight></codeline>
<codeline lineno="814"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;<sp/></highlight></codeline>
<codeline lineno="815"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="816"><highlight class="normal"></highlight></codeline>
<codeline lineno="817"><highlight class="normal"><sp/><sp/><sp/><sp/>MPI_Recv(<sp/>buf_ser,<sp/>1,<sp/>buf_t,<sp/>source,<sp/>FTI_Conf-&gt;<ref refid="structFTIT__configuration_1a6f1b79f826e4ced2ac4faad025cc6c5d" kindref="member">stageTag</ref>,<sp/>FTI_Exec-&gt;<ref refid="structFTIT__execution_1abbb23501615ec870e650aad5f26b85d3" kindref="member">nodeComm</ref>,<sp/>MPI_STATUS_IGNORE<sp/>);</highlight></codeline>
<codeline lineno="818"><highlight class="normal"></highlight></codeline>
<codeline lineno="819"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>set<sp/>local<sp/>file<sp/>path</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="820"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>lpath[<ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>];</highlight></codeline>
<codeline lineno="821"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>rpath[<ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>];</highlight></codeline>
<codeline lineno="822"><highlight class="normal"></highlight></codeline>
<codeline lineno="823"><highlight class="normal"><sp/><sp/><sp/><sp/>strncpy(<sp/>lpath,<sp/>buf_ser,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref><sp/>);</highlight></codeline>
<codeline lineno="824"><highlight class="normal"><sp/><sp/><sp/><sp/>strncpy(<sp/>rpath,<sp/>buf_ser+<ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref><sp/>);</highlight></codeline>
<codeline lineno="825"><highlight class="normal"><sp/><sp/><sp/><sp/>lpath[<ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>-1]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="826"><highlight class="normal"><sp/><sp/><sp/><sp/>rpath[<ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>-1]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="827"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ID<sp/>=<sp/>*(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">*)(buf_ser+2*<ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>);</highlight></codeline>
<codeline lineno="828"><highlight class="normal"></highlight></codeline>
<codeline lineno="829"><highlight class="normal"><sp/><sp/><sp/><sp/>free(<sp/>buf_ser<sp/>);</highlight></codeline>
<codeline lineno="830"><highlight class="normal"></highlight></codeline>
<codeline lineno="831"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>init<sp/>Head<sp/>staging<sp/>meta<sp/>data</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="832"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/><ref refid="stage_8c_1ae4b37a2f01edc58f583e828993eda152" kindref="member">FTI_InitStageRequestHead</ref>(<sp/>lpath,<sp/>rpath,<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>source,<sp/>ID<sp/>)<sp/>!=<sp/><ref refid="fti_8h_1a8c1f0a06b877c18a7270d54c5e6039cf" kindref="member">FTI_SCES</ref><sp/>)<sp/>{</highlight></codeline>
<codeline lineno="833"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;failed<sp/>to<sp/>initialize<sp/>stage<sp/>request<sp/>meta<sp/>info!&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a93eeeef1e283517099194859e3811ea3" kindref="member">FTI_WARN</ref><sp/>);</highlight></codeline>
<codeline lineno="834"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" kindref="member">FTI_SetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="fti_8h_1a8b63f0cd5d9aa9417c3d3ec5a703ca1b" kindref="member">FTI_SI_FAIL</ref>,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="835"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="836"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="837"><highlight class="normal"></highlight></codeline>
<codeline lineno="838"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>set<sp/>buffer<sp/>size<sp/>for<sp/>the<sp/>file<sp/>data<sp/>transfer</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="839"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>bs<sp/>=<sp/>FTI_Conf-&gt;<ref refid="structFTIT__configuration_1a090ca8bd3b6c624641bad1cb94678167" kindref="member">transferSize</ref>;</highlight></codeline>
<codeline lineno="840"><highlight class="normal"></highlight></codeline>
<codeline lineno="841"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>check<sp/>local<sp/>file<sp/>and<sp/>get<sp/>file<sp/>size</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="842"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">stat<sp/>st;</highlight></codeline>
<codeline lineno="843"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/><sp/>stat(<sp/>lpath,<sp/>&amp;st<sp/>)<sp/>==<sp/>-1<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="844"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1a6e74aba3e759272cbdb8db6ccbb879f2" kindref="member">FTI_FreeStageRequest</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="845"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" kindref="member">FTI_SetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="fti_8h_1a8b63f0cd5d9aa9417c3d3ec5a703ca1b" kindref="member">FTI_SI_FAIL</ref>,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="846"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(<sp/>errstr,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Could<sp/>not<sp/>stat<sp/>the<sp/>local<sp/>file<sp/>(&apos;%s&apos;)<sp/>for<sp/>staging.&quot;</highlight><highlight class="normal">,<sp/>lpath<sp/>);</highlight></codeline>
<codeline lineno="847"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/>errstr,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref><sp/>);</highlight></codeline>
<codeline lineno="848"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="849"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="850"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>!S_ISREG(st.st_mode)<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="851"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1a6e74aba3e759272cbdb8db6ccbb879f2" kindref="member">FTI_FreeStageRequest</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="852"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" kindref="member">FTI_SetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="fti_8h_1a8b63f0cd5d9aa9417c3d3ec5a703ca1b" kindref="member">FTI_SI_FAIL</ref>,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="853"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(<sp/>errstr,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>,<sp/></highlight><highlight class="stringliteral">&quot;&apos;%s&apos;<sp/>is<sp/>not<sp/>a<sp/>regular<sp/>file,<sp/>staging<sp/>failed.&quot;</highlight><highlight class="normal">,<sp/>lpath<sp/>);</highlight></codeline>
<codeline lineno="854"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/>errstr,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref><sp/>);</highlight></codeline>
<codeline lineno="855"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="856"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="857"><highlight class="normal"></highlight></codeline>
<codeline lineno="858"><highlight class="normal"><sp/><sp/><sp/><sp/>off_t<sp/>eof<sp/>=<sp/>st.st_size;</highlight></codeline>
<codeline lineno="859"><highlight class="normal"></highlight></codeline>
<codeline lineno="860"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>duplicate<sp/>rpath<sp/>(dirname<sp/>modifies<sp/>its<sp/>argument!)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="861"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*dirc<sp/>=<sp/>strdup(rpath);</highlight></codeline>
<codeline lineno="862"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>dirc<sp/>==<sp/>NULL<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="863"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1a6e74aba3e759272cbdb8db6ccbb879f2" kindref="member">FTI_FreeStageRequest</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="864"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" kindref="member">FTI_SetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="fti_8h_1a8b63f0cd5d9aa9417c3d3ec5a703ca1b" kindref="member">FTI_SI_FAIL</ref>,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="865"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;failed<sp/>to<sp/>allocate<sp/>memory<sp/>for<sp/>&apos;dirc&apos;<sp/>in<sp/>&apos;FTI_HandleStageRequest&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref><sp/>);</highlight></codeline>
<codeline lineno="866"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="867"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="868"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*dir_name<sp/>=<sp/>dirname(dirc);</highlight></codeline>
<codeline lineno="869"><highlight class="normal"></highlight></codeline>
<codeline lineno="870"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>check<sp/>if<sp/>remote<sp/>directory<sp/>exists</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="871"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>stat(<sp/>dir_name,<sp/>&amp;st<sp/>)<sp/>!=<sp/>0<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="872"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>errno<sp/>==<sp/>ENOENT<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="873"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1a6e74aba3e759272cbdb8db6ccbb879f2" kindref="member">FTI_FreeStageRequest</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="874"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" kindref="member">FTI_SetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="fti_8h_1a8b63f0cd5d9aa9417c3d3ec5a703ca1b" kindref="member">FTI_SI_FAIL</ref>,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="875"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(<sp/>errstr,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>,<sp/></highlight><highlight class="stringliteral">&quot;The<sp/>directory<sp/>&apos;%s&apos;<sp/>does<sp/>not<sp/>exist,<sp/>staging<sp/>failed.&quot;</highlight><highlight class="normal">,<sp/>dir_name<sp/>);</highlight></codeline>
<codeline lineno="876"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/>errstr,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref><sp/>);</highlight></codeline>
<codeline lineno="877"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="878"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="879"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1a6e74aba3e759272cbdb8db6ccbb879f2" kindref="member">FTI_FreeStageRequest</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="880"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" kindref="member">FTI_SetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="fti_8h_1a8b63f0cd5d9aa9417c3d3ec5a703ca1b" kindref="member">FTI_SI_FAIL</ref>,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="881"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(<sp/>errstr,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>stat<sp/>&apos;%s&apos;,<sp/>abort<sp/>staging.&quot;</highlight><highlight class="normal">,<sp/>dir_name<sp/>);</highlight></codeline>
<codeline lineno="882"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/>errstr,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref><sp/>);</highlight></codeline>
<codeline lineno="883"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="884"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="885"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="886"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>check<sp/>if<sp/>it<sp/>is<sp/>indeed<sp/>a<sp/>directory</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="887"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!S_ISDIR(st.st_mode)<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="888"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1a6e74aba3e759272cbdb8db6ccbb879f2" kindref="member">FTI_FreeStageRequest</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="889"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" kindref="member">FTI_SetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="fti_8h_1a8b63f0cd5d9aa9417c3d3ec5a703ca1b" kindref="member">FTI_SI_FAIL</ref>,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="890"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(<sp/>errstr,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>,<sp/></highlight><highlight class="stringliteral">&quot;&apos;%s&apos;<sp/>is<sp/>not<sp/>a<sp/>directory,<sp/>abort<sp/>staging.&quot;</highlight><highlight class="normal">,<sp/>dir_name<sp/>);</highlight></codeline>
<codeline lineno="891"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/>errstr,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref><sp/>);</highlight></codeline>
<codeline lineno="892"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="893"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="894"><highlight class="normal"></highlight></codeline>
<codeline lineno="895"><highlight class="normal"><sp/><sp/><sp/><sp/>free(<sp/>dirc<sp/>);</highlight></codeline>
<codeline lineno="896"><highlight class="normal"></highlight></codeline>
<codeline lineno="897"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>check<sp/>if<sp/>remote<sp/>file<sp/>already<sp/>exist</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="898"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/><sp/>stat(<sp/>rpath,<sp/>&amp;st<sp/>)<sp/>==<sp/>0<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="899"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>S_ISREG(st.st_mode)<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="900"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>warnstr[<ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>];</highlight></codeline>
<codeline lineno="901"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(<sp/>warnstr,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>,<sp/></highlight><highlight class="stringliteral">&quot;remote<sp/>file<sp/>&apos;%s&apos;<sp/>already<sp/>exists,<sp/>attempt<sp/>to<sp/>overwrite.&quot;</highlight><highlight class="normal">,<sp/>rpath<sp/>);</highlight></codeline>
<codeline lineno="902"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/>warnstr,<sp/><ref refid="fti-intern_8h_1a93eeeef1e283517099194859e3811ea3" kindref="member">FTI_WARN</ref><sp/>);</highlight></codeline>
<codeline lineno="903"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="904"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="905"><highlight class="normal"></highlight></codeline>
<codeline lineno="906"><highlight class="normal"></highlight></codeline>
<codeline lineno="907"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>open<sp/>local<sp/>file</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="908"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>fd_local<sp/>=<sp/>open(<sp/>lpath,<sp/>O_RDONLY<sp/>);</highlight></codeline>
<codeline lineno="909"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>fd_local<sp/>==<sp/>-1<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="910"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1a6e74aba3e759272cbdb8db6ccbb879f2" kindref="member">FTI_FreeStageRequest</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="911"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" kindref="member">FTI_SetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="fti_8h_1a8b63f0cd5d9aa9417c3d3ec5a703ca1b" kindref="member">FTI_SI_FAIL</ref>,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="912"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(</highlight><highlight class="stringliteral">&quot;Could<sp/>not<sp/>open<sp/>the<sp/>local<sp/>file<sp/>for<sp/>staging&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref>);</highlight></codeline>
<codeline lineno="913"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="914"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="915"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>open<sp/>file<sp/>on<sp/>remote<sp/>fs</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="916"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>fd_global<sp/>=<sp/>open(<sp/>rpath,<sp/>O_WRONLY|O_CREAT,<sp/>(mode_t)<sp/>0600<sp/>);</highlight></codeline>
<codeline lineno="917"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>fd_global<sp/>==<sp/>-1<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="918"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1a6e74aba3e759272cbdb8db6ccbb879f2" kindref="member">FTI_FreeStageRequest</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="919"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" kindref="member">FTI_SetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="fti_8h_1a8b63f0cd5d9aa9417c3d3ec5a703ca1b" kindref="member">FTI_SI_FAIL</ref>,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="920"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(</highlight><highlight class="stringliteral">&quot;Could<sp/>not<sp/>open<sp/>the<sp/>destination<sp/>file<sp/>for<sp/>staging&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref>);</highlight></codeline>
<codeline lineno="921"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>close(<sp/>fd_local<sp/>);</highlight></codeline>
<codeline lineno="922"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="923"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="924"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>allocate<sp/>buffer</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="925"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*buf<sp/>=<sp/>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*)<sp/>malloc(<sp/>bs<sp/>);</highlight></codeline>
<codeline lineno="926"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>buf<sp/>==<sp/>NULL<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="927"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>close<sp/>(<sp/>fd_local<sp/>);</highlight></codeline>
<codeline lineno="928"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>close<sp/>(<sp/>fd_global<sp/>);</highlight></codeline>
<codeline lineno="929"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1a6e74aba3e759272cbdb8db6ccbb879f2" kindref="member">FTI_FreeStageRequest</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="930"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" kindref="member">FTI_SetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="fti_8h_1a8b63f0cd5d9aa9417c3d3ec5a703ca1b" kindref="member">FTI_SI_FAIL</ref>,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="931"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;failed<sp/>to<sp/>allocate<sp/>memory<sp/>for<sp/>&apos;buf&apos;<sp/>in<sp/>&apos;FTI_HandleStageRequest&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref><sp/>);</highlight></codeline>
<codeline lineno="932"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="933"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="934"><highlight class="normal"></highlight></codeline>
<codeline lineno="935"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>move<sp/>file<sp/>to<sp/>destination</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="936"><highlight class="normal"><sp/><sp/><sp/><sp/>off_t<sp/>pos<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="937"><highlight class="normal"><sp/><sp/><sp/><sp/>ssize_t<sp/>read_bytes,<sp/>write_bytes;</highlight></codeline>
<codeline lineno="938"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>buf_bytes;</highlight></codeline>
<codeline lineno="939"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal">(<sp/>pos<sp/>&lt;<sp/>eof<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="940"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>buf_bytes<sp/>=<sp/>(<sp/>(eof<sp/>-<sp/>pos)<sp/>&lt;<sp/>bs<sp/>)<sp/>?<sp/>eof<sp/>-<sp/>pos<sp/>:<sp/>bs;</highlight></codeline>
<codeline lineno="941"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>the<sp/>case<sp/>we<sp/>have<sp/>written<sp/>less<sp/>then<sp/>we<sp/>have<sp/>read</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="942"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>lseek(<sp/>fd_local,<sp/>pos,<sp/>SEEK_SET<sp/>)<sp/>==<sp/>-1<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="943"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1a6e74aba3e759272cbdb8db6ccbb879f2" kindref="member">FTI_FreeStageRequest</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="944"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" kindref="member">FTI_SetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="fti_8h_1a8b63f0cd5d9aa9417c3d3ec5a703ca1b" kindref="member">FTI_SI_FAIL</ref>,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="945"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(<sp/>errstr,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>,<sp/></highlight><highlight class="stringliteral">&quot;unable<sp/>to<sp/>seek<sp/>in<sp/>&apos;%s&apos;.&quot;</highlight><highlight class="normal">,<sp/>lpath<sp/>);</highlight></codeline>
<codeline lineno="946"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/>errstr,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref><sp/>);</highlight></codeline>
<codeline lineno="947"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>errno<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="948"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(<sp/>buf<sp/>);</highlight></codeline>
<codeline lineno="949"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>close(<sp/>fd_local<sp/>);</highlight></codeline>
<codeline lineno="950"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>close(<sp/>fd_global<sp/>);</highlight></codeline>
<codeline lineno="951"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="952"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="953"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>(read_bytes<sp/>=<sp/>read(<sp/>fd_local,<sp/>buf,<sp/>buf_bytes<sp/>))<sp/>==<sp/>-1<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="954"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1a6e74aba3e759272cbdb8db6ccbb879f2" kindref="member">FTI_FreeStageRequest</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="955"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" kindref="member">FTI_SetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="fti_8h_1a8b63f0cd5d9aa9417c3d3ec5a703ca1b" kindref="member">FTI_SI_FAIL</ref>,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="956"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(<sp/>errstr,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>,<sp/></highlight><highlight class="stringliteral">&quot;unable<sp/>to<sp/>read<sp/>from<sp/>&apos;%s&apos;.&quot;</highlight><highlight class="normal">,<sp/>lpath<sp/>);</highlight></codeline>
<codeline lineno="957"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/>errstr,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref><sp/>);</highlight></codeline>
<codeline lineno="958"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>errno<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="959"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(<sp/>buf<sp/>);</highlight></codeline>
<codeline lineno="960"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>close(<sp/>fd_local<sp/>);</highlight></codeline>
<codeline lineno="961"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>close(<sp/>fd_global<sp/>);</highlight></codeline>
<codeline lineno="962"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="963"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="964"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>(write_bytes<sp/>=<sp/>write(<sp/>fd_global,<sp/>buf,<sp/>read_bytes<sp/>))<sp/>==<sp/>-1<sp/>)<sp/>{<sp/><sp/></highlight></codeline>
<codeline lineno="965"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1a6e74aba3e759272cbdb8db6ccbb879f2" kindref="member">FTI_FreeStageRequest</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="966"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" kindref="member">FTI_SetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="fti_8h_1a8b63f0cd5d9aa9417c3d3ec5a703ca1b" kindref="member">FTI_SI_FAIL</ref>,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="967"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(<sp/>errstr,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>,<sp/></highlight><highlight class="stringliteral">&quot;unable<sp/>to<sp/>write<sp/>to<sp/>&apos;%s&apos;.&quot;</highlight><highlight class="normal">,<sp/>rpath<sp/>);</highlight></codeline>
<codeline lineno="968"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/>errstr,<sp/><ref refid="fti-intern_8h_1a5cb1252ae17ef4ac13b3dbe5a8b1ab13" kindref="member">FTI_EROR</ref><sp/>);</highlight></codeline>
<codeline lineno="969"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>errno<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="970"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(<sp/>buf<sp/>);</highlight></codeline>
<codeline lineno="971"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>close(<sp/>fd_local<sp/>);</highlight></codeline>
<codeline lineno="972"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>close(<sp/>fd_global<sp/>);</highlight></codeline>
<codeline lineno="973"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="974"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="975"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pos<sp/>+=<sp/>write_bytes;</highlight></codeline>
<codeline lineno="976"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="977"><highlight class="normal"></highlight></codeline>
<codeline lineno="978"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>deallocate<sp/>buffer<sp/>and<sp/>close<sp/>file<sp/>descriptors</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="979"><highlight class="normal"><sp/><sp/><sp/><sp/>free(<sp/>buf<sp/>);</highlight></codeline>
<codeline lineno="980"><highlight class="normal"><sp/><sp/><sp/><sp/>close(<sp/>fd_local<sp/>);</highlight></codeline>
<codeline lineno="981"><highlight class="normal"><sp/><sp/><sp/><sp/>fsync(<sp/>fd_global<sp/>);</highlight></codeline>
<codeline lineno="982"><highlight class="normal"><sp/><sp/><sp/><sp/>close(<sp/>fd_global<sp/>);</highlight></codeline>
<codeline lineno="983"><highlight class="normal"></highlight></codeline>
<codeline lineno="984"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" kindref="member">FTI_SetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="fti_8h_1a93cefc8dced9cb5c63c45708ef89694b" kindref="member">FTI_SI_SCES</ref>,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="985"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="stage_8c_1a6e74aba3e759272cbdb8db6ccbb879f2" kindref="member">FTI_FreeStageRequest</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="986"><highlight class="normal"></highlight></codeline>
<codeline lineno="987"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a8c1f0a06b877c18a7270d54c5e6039cf" kindref="member">FTI_SCES</ref>;</highlight></codeline>
<codeline lineno="988"><highlight class="normal">}</highlight></codeline>
<codeline lineno="989"><highlight class="normal"></highlight></codeline>
<codeline lineno="990"><highlight class="normal"></highlight><highlight class="comment">/*-------------------------------------------------------------------------*/</highlight></codeline>
<codeline lineno="997"><highlight class="comment">/*-------------------------------------------------------------------------*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="998" refid="stage_8h_1a1b29cd8c8e9446f2dbd8dafac4d07f05" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="stage_8c_1a1b29cd8c8e9446f2dbd8dafac4d07f05" kindref="member">FTI_GetRequestField</ref>(<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ID,<sp/><ref refid="stage_8h_1a05ee3f86e04233d44812d99f1ce02f98" kindref="member">FTIT_RequestField</ref><sp/>val<sp/>)<sp/></highlight></codeline>
<codeline lineno="999"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1000"><highlight class="normal"></highlight></codeline>
<codeline lineno="1001"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!<ref refid="stage_8h_1aa81d3d5a8f468c54e216747e4937c77c" kindref="member">FTI_SI_ENABLED</ref><sp/>)<sp/>{</highlight></codeline>
<codeline lineno="1002"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;Staging<sp/>disabled,<sp/>invalid<sp/>call<sp/>to<sp/>&apos;FTI_GetRequestField&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a93eeeef1e283517099194859e3811ea3" kindref="member">FTI_WARN</ref><sp/>);</highlight></codeline>
<codeline lineno="1003"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="1004"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1005"><highlight class="normal"></highlight></codeline>
<codeline lineno="1006"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>(val<sp/>&lt;<sp/><ref refid="stage_8h_1a05ee3f86e04233d44812d99f1ce02f98a284a69ddc599e948a41d29045bf417a7" kindref="member">FTI_SIF_ALL</ref>)<sp/>||<sp/>(val<sp/>&gt;<sp/><ref refid="stage_8h_1a05ee3f86e04233d44812d99f1ce02f98a45cfcc08399841b15ebd1df39e23cfa8" kindref="member">FTI_SIF_IDX</ref>)<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="1007"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;invalid<sp/>argument<sp/>for<sp/>&apos;FTI_GetRequestIdxField&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a93eeeef1e283517099194859e3811ea3" kindref="member">FTI_WARN</ref><sp/>);</highlight></codeline>
<codeline lineno="1008"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="1009"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1010"><highlight class="normal"></highlight></codeline>
<codeline lineno="1011"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint32_t<sp/>all_mask<sp/>=<sp/>0x00080000;</highlight></codeline>
<codeline lineno="1012"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint32_t<sp/>idx_mask<sp/>=<sp/>0x0007FFFF;<sp/></highlight><highlight class="comment">//<sp/>524,288<sp/>ID&apos;s,<sp/>max<sp/>ID:<sp/>524,287</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1013"><highlight class="normal"></highlight></codeline>
<codeline lineno="1014"><highlight class="normal"><sp/><sp/><sp/><sp/>uint32_t<sp/>field<sp/>=<sp/>idxRequest[ID];</highlight></codeline>
<codeline lineno="1015"><highlight class="normal"></highlight></codeline>
<codeline lineno="1016"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>query;</highlight></codeline>
<codeline lineno="1017"><highlight class="normal"></highlight></codeline>
<codeline lineno="1018"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal">(<sp/>val<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="1019"><highlight class="normal"></highlight></codeline>
<codeline lineno="1020"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="stage_8h_1a05ee3f86e04233d44812d99f1ce02f98a284a69ddc599e948a41d29045bf417a7" kindref="member">FTI_SIF_ALL</ref>:</highlight></codeline>
<codeline lineno="1021"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>query<sp/>=<sp/>(int)((field<sp/>&amp;<sp/>all_mask)<sp/>&gt;&gt;<sp/>19);</highlight></codeline>
<codeline lineno="1022"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1023"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="stage_8h_1a05ee3f86e04233d44812d99f1ce02f98a45cfcc08399841b15ebd1df39e23cfa8" kindref="member">FTI_SIF_IDX</ref>:</highlight></codeline>
<codeline lineno="1024"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>query<sp/>=<sp/>((int)(field<sp/>&amp;<sp/>idx_mask));</highlight></codeline>
<codeline lineno="1025"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1026"><highlight class="normal"></highlight></codeline>
<codeline lineno="1027"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1028"><highlight class="normal"></highlight></codeline>
<codeline lineno="1029"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>query;</highlight></codeline>
<codeline lineno="1030"><highlight class="normal"></highlight></codeline>
<codeline lineno="1031"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1032"><highlight class="normal"></highlight></codeline>
<codeline lineno="1033"><highlight class="normal"></highlight><highlight class="comment">/*-------------------------------------------------------------------------*/</highlight></codeline>
<codeline lineno="1041"><highlight class="comment">/*-------------------------------------------------------------------------*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1042" refid="stage_8h_1a35eb6e7616b99b2d7713d802327fe061" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="stage_8c_1a35eb6e7616b99b2d7713d802327fe061" kindref="member">FTI_SetRequestField</ref>(<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ID,<sp/>uint32_t<sp/>entry,<sp/><ref refid="stage_8h_1a05ee3f86e04233d44812d99f1ce02f98" kindref="member">FTIT_RequestField</ref><sp/>val<sp/>)</highlight></codeline>
<codeline lineno="1043"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1044"><highlight class="normal"></highlight></codeline>
<codeline lineno="1045"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!<ref refid="stage_8h_1aa81d3d5a8f468c54e216747e4937c77c" kindref="member">FTI_SI_ENABLED</ref><sp/>)<sp/>{</highlight></codeline>
<codeline lineno="1046"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;Staging<sp/>disabled,<sp/>invalid<sp/>call<sp/>to<sp/>&apos;FTI_SetRequestField&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a93eeeef1e283517099194859e3811ea3" kindref="member">FTI_WARN</ref><sp/>);</highlight></codeline>
<codeline lineno="1047"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="1048"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1049"><highlight class="normal"></highlight></codeline>
<codeline lineno="1050"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>(val<sp/>&lt;<sp/><ref refid="stage_8h_1a05ee3f86e04233d44812d99f1ce02f98a284a69ddc599e948a41d29045bf417a7" kindref="member">FTI_SIF_ALL</ref>)<sp/>||<sp/>(val<sp/>&gt;<sp/><ref refid="stage_8h_1a05ee3f86e04233d44812d99f1ce02f98a45cfcc08399841b15ebd1df39e23cfa8" kindref="member">FTI_SIF_IDX</ref>)<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="1051"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;invalid<sp/>argument<sp/>for<sp/>&apos;FTI_SetRequestIdxField&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a93eeeef1e283517099194859e3811ea3" kindref="member">FTI_WARN</ref><sp/>);</highlight></codeline>
<codeline lineno="1052"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="1053"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1054"><highlight class="normal"></highlight></codeline>
<codeline lineno="1055"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint32_t<sp/>all_mask<sp/>=<sp/>0x00080000;</highlight></codeline>
<codeline lineno="1056"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint32_t<sp/>idx_mask<sp/>=<sp/>0x0007FFFF;<sp/></highlight><highlight class="comment">//<sp/>524,288<sp/>ID&apos;s,<sp/>max<sp/>ID:<sp/>524,287</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1057"><highlight class="normal"></highlight></codeline>
<codeline lineno="1058"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>err<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1059"><highlight class="normal"></highlight></codeline>
<codeline lineno="1060"><highlight class="normal"><sp/><sp/><sp/><sp/>uint32_t<sp/>field<sp/>=<sp/>idxRequest[ID];</highlight></codeline>
<codeline lineno="1061"><highlight class="normal"></highlight></codeline>
<codeline lineno="1062"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal">(<sp/>val<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="1063"><highlight class="normal"></highlight></codeline>
<codeline lineno="1064"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="stage_8h_1a05ee3f86e04233d44812d99f1ce02f98a284a69ddc599e948a41d29045bf417a7" kindref="member">FTI_SIF_ALL</ref>:</highlight></codeline>
<codeline lineno="1065"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>(<sp/>entry<sp/>&gt;<sp/>0x1<sp/>)<sp/>)<sp/>{<sp/></highlight></codeline>
<codeline lineno="1066"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;invalid<sp/>argument<sp/>for<sp/>&apos;FTI_SetRequestIdxField&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a93eeeef1e283517099194859e3811ea3" kindref="member">FTI_WARN</ref><sp/>);</highlight></codeline>
<codeline lineno="1067"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1068"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1069"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1070"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>field<sp/>=<sp/>(entry<sp/>&lt;&lt;<sp/>19)<sp/>|<sp/>((~all_mask)<sp/>&amp;<sp/>field);</highlight></codeline>
<codeline lineno="1071"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1072"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="stage_8h_1a05ee3f86e04233d44812d99f1ce02f98a45cfcc08399841b15ebd1df39e23cfa8" kindref="member">FTI_SIF_IDX</ref>:</highlight></codeline>
<codeline lineno="1073"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>entry<sp/>&gt;<sp/>idx_mask<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="1074"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;invalid<sp/>argument<sp/>for<sp/>&apos;FTI_SetRequestIdxField&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a93eeeef1e283517099194859e3811ea3" kindref="member">FTI_WARN</ref><sp/>);</highlight></codeline>
<codeline lineno="1075"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>err<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1076"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1077"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1078"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>field<sp/>=<sp/>entry<sp/>|<sp/>((~idx_mask)<sp/>&amp;<sp/>field);</highlight></codeline>
<codeline lineno="1079"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1080"><highlight class="normal"></highlight></codeline>
<codeline lineno="1081"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1082"><highlight class="normal"></highlight></codeline>
<codeline lineno="1083"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!err<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="1084"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>idxRequest[ID]<sp/>=<sp/>field;</highlight></codeline>
<codeline lineno="1085"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>entry;</highlight></codeline>
<codeline lineno="1086"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1087"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="1088"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1089"><highlight class="normal"></highlight></codeline>
<codeline lineno="1090"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1091"><highlight class="normal"></highlight></codeline>
<codeline lineno="1092"><highlight class="normal"></highlight><highlight class="comment">/*-------------------------------------------------------------------------*/</highlight></codeline>
<codeline lineno="1102"><highlight class="comment">/*-------------------------------------------------------------------------*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1103" refid="stage_8h_1a03ebd25f6254d11bc790e70e9aabd9eb" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="stage_8c_1a03ebd25f6254d11bc790e70e9aabd9eb" kindref="member">FTI_GetStatusField</ref>(<sp/><ref refid="structFTIT__execution" kindref="compound">FTIT_execution</ref><sp/>*FTI_Exec,<sp/><ref refid="structFTIT__topology" kindref="compound">FTIT_topology</ref><sp/>*FTI_Topo,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ID,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887" kindref="member">FTIT_StatusField</ref><sp/>val,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>source<sp/>)<sp/></highlight></codeline>
<codeline lineno="1104"><highlight class="normal">{<sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1105"><highlight class="normal"></highlight></codeline>
<codeline lineno="1106"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!<ref refid="stage_8h_1aa81d3d5a8f468c54e216747e4937c77c" kindref="member">FTI_SI_ENABLED</ref><sp/>)<sp/>{</highlight></codeline>
<codeline lineno="1107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;Staging<sp/>disabled,<sp/>invalid<sp/>call<sp/>to<sp/>&apos;FTI_GetStatusField&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a93eeeef1e283517099194859e3811ea3" kindref="member">FTI_WARN</ref><sp/>);</highlight></codeline>
<codeline lineno="1108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="1109"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1110"><highlight class="normal"></highlight></codeline>
<codeline lineno="1111"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>(val<sp/>&lt;<sp/>0)<sp/>||<sp/>(val<sp/>&gt;<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>)<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="1112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;invalid<sp/>argument<sp/>for<sp/>&apos;FTI_GetStatusField&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a93eeeef1e283517099194859e3811ea3" kindref="member">FTI_WARN</ref><sp/>);</highlight></codeline>
<codeline lineno="1113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="1114"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1115"><highlight class="normal"></highlight></codeline>
<codeline lineno="1116"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint8_t<sp/>val_mask<sp/>=<sp/>0xE;</highlight></codeline>
<codeline lineno="1117"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint8_t<sp/>avl_mask<sp/>=<sp/>0x1;</highlight></codeline>
<codeline lineno="1118"><highlight class="normal"></highlight></codeline>
<codeline lineno="1119"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>disp;</highlight></codeline>
<codeline lineno="1120"><highlight class="normal"><sp/><sp/><sp/><sp/>MPI_Aint<sp/>size;</highlight></codeline>
<codeline lineno="1121"><highlight class="normal"><sp/><sp/><sp/><sp/>MPI_Win_shared_query(<sp/>stageWin,<sp/>source,<sp/>&amp;size,<sp/>&amp;disp,<sp/>&amp;(status)<sp/>);<sp/></highlight></codeline>
<codeline lineno="1122"><highlight class="normal"><sp/><sp/><sp/><sp/>uint8_t<sp/>status_cpy<sp/>=<sp/>status[ID];</highlight></codeline>
<codeline lineno="1123"><highlight class="normal"></highlight></codeline>
<codeline lineno="1124"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>query;</highlight></codeline>
<codeline lineno="1125"><highlight class="normal"></highlight></codeline>
<codeline lineno="1126"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal">(<sp/>val<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="1127"><highlight class="normal"></highlight></codeline>
<codeline lineno="1128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>:</highlight></codeline>
<codeline lineno="1129"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>query<sp/>=<sp/>((int)(status_cpy<sp/>&amp;<sp/>val_mask))<sp/>&gt;&gt;<sp/>1;</highlight></codeline>
<codeline lineno="1130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a3c0c80cbe8e4a14370a8a47f2a54b6ba" kindref="member">FTI_SIF_AVL</ref>:</highlight></codeline>
<codeline lineno="1132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>query<sp/>=<sp/>((int)(status_cpy<sp/>&amp;<sp/>avl_mask));</highlight></codeline>
<codeline lineno="1133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1134"><highlight class="normal"></highlight></codeline>
<codeline lineno="1135"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1136"><highlight class="normal"></highlight></codeline>
<codeline lineno="1137"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>query;</highlight></codeline>
<codeline lineno="1138"><highlight class="normal"></highlight></codeline>
<codeline lineno="1139"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1140"><highlight class="normal"></highlight></codeline>
<codeline lineno="1141"><highlight class="normal"></highlight><highlight class="comment">/*-------------------------------------------------------------------------*/</highlight></codeline>
<codeline lineno="1152"><highlight class="comment">/*-------------------------------------------------------------------------*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1153" refid="stage_8h_1ab210803902592adb2ebb22b9a9a28dda" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" kindref="member">FTI_SetStatusField</ref>(<sp/><ref refid="structFTIT__execution" kindref="compound">FTIT_execution</ref><sp/>*FTI_Exec,<sp/><ref refid="structFTIT__topology" kindref="compound">FTIT_topology</ref><sp/>*FTI_Topo,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ID,<sp/>uint8_t<sp/>entry,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887" kindref="member">FTIT_StatusField</ref><sp/>val,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>source<sp/>)</highlight></codeline>
<codeline lineno="1154"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1155"><highlight class="normal"></highlight></codeline>
<codeline lineno="1156"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!<ref refid="stage_8h_1aa81d3d5a8f468c54e216747e4937c77c" kindref="member">FTI_SI_ENABLED</ref><sp/>)<sp/>{</highlight></codeline>
<codeline lineno="1157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;Staging<sp/>disabled,<sp/>invalid<sp/>call<sp/>to<sp/>&apos;FTI_SetStatusField&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a93eeeef1e283517099194859e3811ea3" kindref="member">FTI_WARN</ref><sp/>);</highlight></codeline>
<codeline lineno="1158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="1159"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1160"><highlight class="normal"></highlight></codeline>
<codeline lineno="1161"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>(val<sp/>&lt;<sp/>0)<sp/>||<sp/>(val<sp/>&gt;<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>)<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="1162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;invalid<sp/>argument<sp/>for<sp/>&apos;FTI_GetStatusField&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a93eeeef1e283517099194859e3811ea3" kindref="member">FTI_WARN</ref><sp/>);</highlight></codeline>
<codeline lineno="1163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="1164"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1165"><highlight class="normal"></highlight></codeline>
<codeline lineno="1166"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint8_t<sp/>val_mask<sp/>=<sp/>0xE;<sp/></highlight><highlight class="comment">//<sp/>in<sp/>bits:<sp/>1110</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1167"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint8_t<sp/>avl_mask<sp/>=<sp/>0x1;<sp/></highlight><highlight class="comment">//<sp/>in<sp/>bits:<sp/>0001</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1168"><highlight class="normal"></highlight></codeline>
<codeline lineno="1169"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ierr<sp/>=<sp/><ref refid="fti_8h_1a8c1f0a06b877c18a7270d54c5e6039cf" kindref="member">FTI_SCES</ref>;</highlight></codeline>
<codeline lineno="1170"><highlight class="normal"></highlight></codeline>
<codeline lineno="1171"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>disp;</highlight></codeline>
<codeline lineno="1172"><highlight class="normal"><sp/><sp/><sp/><sp/>MPI_Aint<sp/>size;</highlight></codeline>
<codeline lineno="1173"><highlight class="normal"><sp/><sp/><sp/><sp/>MPI_Win_shared_query(<sp/>stageWin,<sp/>source,<sp/>&amp;size,<sp/>&amp;disp,<sp/>&amp;(status)<sp/>);<sp/></highlight></codeline>
<codeline lineno="1174"><highlight class="normal"><sp/><sp/><sp/><sp/>uint8_t<sp/>status_cpy<sp/>=<sp/>status[ID];</highlight></codeline>
<codeline lineno="1175"><highlight class="normal"></highlight></codeline>
<codeline lineno="1176"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal">(<sp/>val<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="1177"><highlight class="normal"></highlight></codeline>
<codeline lineno="1178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>:</highlight></codeline>
<codeline lineno="1179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>(entry<sp/>&gt;<sp/>0x4)<sp/>)<sp/>{<sp/></highlight></codeline>
<codeline lineno="1180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;invalid<sp/>argument<sp/>for<sp/>&apos;FTI_SetStatusField&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a93eeeef1e283517099194859e3811ea3" kindref="member">FTI_WARN</ref><sp/>);</highlight></codeline>
<codeline lineno="1181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ierr<sp/>=<sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="1182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>status_cpy<sp/>=<sp/>(entry<sp/>&lt;&lt;<sp/>1)<sp/>|<sp/>((~val_mask)<sp/>&amp;<sp/>status_cpy);</highlight></codeline>
<codeline lineno="1185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a3c0c80cbe8e4a14370a8a47f2a54b6ba" kindref="member">FTI_SIF_AVL</ref>:</highlight></codeline>
<codeline lineno="1187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>entry<sp/>&gt;<sp/>0x1<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="1188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;invalid<sp/>argument<sp/>for<sp/>&apos;FTI_SetStatusField&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a93eeeef1e283517099194859e3811ea3" kindref="member">FTI_WARN</ref><sp/>);</highlight></codeline>
<codeline lineno="1189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ierr<sp/>=<sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="1190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>status_cpy<sp/>=<sp/>entry<sp/>|<sp/>((~avl_mask)<sp/>&amp;<sp/>status_cpy);</highlight></codeline>
<codeline lineno="1193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1194"><highlight class="normal"></highlight></codeline>
<codeline lineno="1195"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1196"><highlight class="normal"></highlight></codeline>
<codeline lineno="1197"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>ierr<sp/>==<sp/><ref refid="fti_8h_1a8c1f0a06b877c18a7270d54c5e6039cf" kindref="member">FTI_SCES</ref><sp/>)<sp/>{</highlight></codeline>
<codeline lineno="1198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>status[ID]<sp/>=<sp/>status_cpy;</highlight></codeline>
<codeline lineno="1199"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1200"><highlight class="normal"></highlight></codeline>
<codeline lineno="1201"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ierr;</highlight></codeline>
<codeline lineno="1202"><highlight class="normal"></highlight></codeline>
<codeline lineno="1203"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1204"><highlight class="normal"></highlight></codeline>
<codeline lineno="1205"><highlight class="normal"></highlight><highlight class="comment">/*-------------------------------------------------------------------------*/</highlight></codeline>
<codeline lineno="1212"><highlight class="comment">/*-------------------------------------------------------------------------*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1213" refid="stage_8h_1af704cfca36ed0ca9ab685a838518c114" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="stage_8c_1af704cfca36ed0ca9ab685a838518c114" kindref="member">FTI_GetRequestID</ref>(<sp/><ref refid="structFTIT__execution" kindref="compound">FTIT_execution</ref><sp/>*FTI_Exec,<sp/><ref refid="structFTIT__topology" kindref="compound">FTIT_topology</ref><sp/>*FTI_Topo<sp/>)<sp/></highlight></codeline>
<codeline lineno="1214"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1215"><highlight class="normal"></highlight></codeline>
<codeline lineno="1216"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!<ref refid="stage_8h_1aa81d3d5a8f468c54e216747e4937c77c" kindref="member">FTI_SI_ENABLED</ref><sp/>)<sp/>{</highlight></codeline>
<codeline lineno="1217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;Staging<sp/>disabled,<sp/>invalid<sp/>call<sp/>to<sp/>&apos;FTI_GetRequestID&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a93eeeef1e283517099194859e3811ea3" kindref="member">FTI_WARN</ref><sp/>);</highlight></codeline>
<codeline lineno="1218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a06d23a2210e17078a6a8862bb6ed3dbd" kindref="member">FTI_NSCS</ref>;</highlight></codeline>
<codeline lineno="1219"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1220"><highlight class="normal"></highlight></codeline>
<codeline lineno="1221"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ID<sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="1222"><highlight class="normal"></highlight></codeline>
<codeline lineno="1223"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>req_cnt<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1224"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<sp/>req_cnt<sp/>&lt;<sp/><ref refid="stage_8h_1ad88cc2c7bdc825945e93832f0d294ae9" kindref="member">FTI_SI_MAX_NUM</ref><sp/>)<sp/>{</highlight></codeline>
<codeline lineno="1225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ID<sp/>=<sp/>req_cnt++;</highlight></codeline>
<codeline lineno="1226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" kindref="member">FTI_SetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="stage_8h_1aed3bf8a3f1451c28fdf8f7c0d6f80a3f" kindref="member">FTI_SI_NAVL</ref>,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a3c0c80cbe8e4a14370a8a47f2a54b6ba" kindref="member">FTI_SIF_AVL</ref>,<sp/>FTI_Topo-&gt;<ref refid="structFTIT__topology_1a39761a9bc4ad6d0ca46b7ca82593c175" kindref="member">nodeRank</ref><sp/>);</highlight></codeline>
<codeline lineno="1227"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="1229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>return<sp/>first<sp/>free<sp/>status<sp/>element<sp/>index<sp/>(i.e.<sp/>ID)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(<sp/>i=0;<sp/>i&lt;<ref refid="stage_8h_1ad88cc2c7bdc825945e93832f0d294ae9" kindref="member">FTI_SI_MAX_NUM</ref>;<sp/>++i<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="1231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/><ref refid="stage_8c_1a03ebd25f6254d11bc790e70e9aabd9eb" kindref="member">FTI_GetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>i,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a3c0c80cbe8e4a14370a8a47f2a54b6ba" kindref="member">FTI_SIF_AVL</ref>,<sp/>FTI_Topo-&gt;<ref refid="structFTIT__topology_1a39761a9bc4ad6d0ca46b7ca82593c175" kindref="member">nodeRank</ref><sp/>)<sp/>==<sp/><ref refid="stage_8h_1a801ee3b0f00dfbfb2c72f17666565fa8" kindref="member">FTI_SI_IAVL</ref><sp/>)<sp/>{</highlight></codeline>
<codeline lineno="1232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ID<sp/>=<sp/>i;</highlight></codeline>
<codeline lineno="1233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="stage_8c_1ab210803902592adb2ebb22b9a9a28dda" kindref="member">FTI_SetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="stage_8h_1aed3bf8a3f1451c28fdf8f7c0d6f80a3f" kindref="member">FTI_SI_NAVL</ref>,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a3c0c80cbe8e4a14370a8a47f2a54b6ba" kindref="member">FTI_SIF_AVL</ref>,<sp/>FTI_Topo-&gt;<ref refid="structFTIT__topology_1a39761a9bc4ad6d0ca46b7ca82593c175" kindref="member">nodeRank</ref><sp/>);</highlight></codeline>
<codeline lineno="1234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1237"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1238"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ID;</highlight></codeline>
<codeline lineno="1239"><highlight class="normal"></highlight></codeline>
<codeline lineno="1240"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1241"><highlight class="normal"></highlight></codeline>
<codeline lineno="1242"><highlight class="normal"></highlight><highlight class="comment">//<sp/>FOR<sp/>DEBUGGING</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1243" refid="stage_8h_1a11011f5e2b91e35d66c5c39d33aa0aae" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="stage_8c_1a11011f5e2b91e35d66c5c39d33aa0aae" kindref="member">FTI_PrintStageStatus</ref>(<sp/><ref refid="structFTIT__execution" kindref="compound">FTIT_execution</ref><sp/>*FTI_Exec,<sp/><ref refid="structFTIT__topology" kindref="compound">FTIT_topology</ref><sp/>*FTI_Topo,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ID,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>source<sp/>)<sp/></highlight></codeline>
<codeline lineno="1244"><highlight class="normal">{</highlight></codeline>
<codeline lineno="1245"><highlight class="normal"></highlight></codeline>
<codeline lineno="1246"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>!<ref refid="stage_8h_1aa81d3d5a8f468c54e216747e4937c77c" kindref="member">FTI_SI_ENABLED</ref><sp/>)<sp/>{</highlight></codeline>
<codeline lineno="1247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="api_8c_1a691a9e560e92286bb5bc1b5cf2f7b199" kindref="member">FTI_Print</ref>(<sp/></highlight><highlight class="stringliteral">&quot;Staging<sp/>disabled,<sp/>invalid<sp/>call<sp/>to<sp/>&apos;FTI_PrintStageStatus&apos;&quot;</highlight><highlight class="normal">,<sp/><ref refid="fti-intern_8h_1a93eeeef1e283517099194859e3811ea3" kindref="member">FTI_WARN</ref><sp/>);</highlight></codeline>
<codeline lineno="1248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1249"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1250"><highlight class="normal"></highlight></codeline>
<codeline lineno="1251"><highlight class="normal"><sp/><sp/><sp/><sp/>MPI_Aint<sp/>qsize;</highlight></codeline>
<codeline lineno="1252"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>qdisp;</highlight></codeline>
<codeline lineno="1253"><highlight class="normal"><sp/><sp/><sp/><sp/>MPI_Win_shared_query(<sp/>stageWin,<sp/>source,<sp/>&amp;qsize,<sp/>&amp;qdisp,<sp/>&amp;(status)<sp/>);</highlight></codeline>
<codeline lineno="1254"><highlight class="normal"></highlight></codeline>
<codeline lineno="1255"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>val;</highlight></codeline>
<codeline lineno="1256"><highlight class="normal"></highlight></codeline>
<codeline lineno="1257"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>avl<sp/>string</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1258"><highlight class="normal"><sp/><sp/><sp/><sp/>val<sp/>=<sp/><ref refid="stage_8c_1a03ebd25f6254d11bc790e70e9aabd9eb" kindref="member">FTI_GetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a3c0c80cbe8e4a14370a8a47f2a54b6ba" kindref="member">FTI_SIF_AVL</ref>,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="1259"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>avlstr[<ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>];</highlight></codeline>
<codeline lineno="1260"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>val<sp/>==<sp/><ref refid="stage_8h_1a801ee3b0f00dfbfb2c72f17666565fa8" kindref="member">FTI_SI_IAVL</ref><sp/>)<sp/>{</highlight></codeline>
<codeline lineno="1261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>strcpy(<sp/>avlstr,<sp/></highlight><highlight class="stringliteral">&quot;available&quot;</highlight><highlight class="normal"><sp/>);</highlight></codeline>
<codeline lineno="1262"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>val<sp/>==<sp/><ref refid="stage_8h_1aed3bf8a3f1451c28fdf8f7c0d6f80a3f" kindref="member">FTI_SI_NAVL</ref><sp/>)<sp/>{</highlight></codeline>
<codeline lineno="1263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>strcpy(<sp/>avlstr,<sp/></highlight><highlight class="stringliteral">&quot;not<sp/>available&quot;</highlight><highlight class="normal"><sp/>);</highlight></codeline>
<codeline lineno="1264"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(<sp/>avlstr,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>,<sp/></highlight><highlight class="stringliteral">&quot;not<sp/>valid<sp/>(&apos;%d&apos;)&quot;</highlight><highlight class="normal">,<sp/>val<sp/>);</highlight></codeline>
<codeline lineno="1266"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1267"><highlight class="normal"></highlight></codeline>
<codeline lineno="1268"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>idx<sp/>string</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1269"><highlight class="normal"><sp/><sp/><sp/><sp/>val<sp/>=<sp/><ref refid="stage_8c_1a1b29cd8c8e9446f2dbd8dafac4d07f05" kindref="member">FTI_GetRequestField</ref>(<sp/>ID,<sp/><ref refid="stage_8h_1a05ee3f86e04233d44812d99f1ce02f98a45cfcc08399841b15ebd1df39e23cfa8" kindref="member">FTI_SIF_IDX</ref><sp/>);</highlight></codeline>
<codeline lineno="1270"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>idxstr[<ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>];</highlight></codeline>
<codeline lineno="1271"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>val<sp/>&lt;<sp/>0<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="1272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(idxstr,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>,<sp/></highlight><highlight class="stringliteral">&quot;not<sp/>valid<sp/>(&apos;%d&apos;)&quot;</highlight><highlight class="normal">,<sp/>val<sp/>);</highlight></codeline>
<codeline lineno="1273"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(idxstr,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>,<sp/></highlight><highlight class="stringliteral">&quot;%u&quot;</highlight><highlight class="normal">,<sp/>(uint32_t)val<sp/>);</highlight></codeline>
<codeline lineno="1275"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1276"><highlight class="normal"></highlight></codeline>
<codeline lineno="1277"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>status<sp/>value</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1278"><highlight class="normal"><sp/><sp/><sp/><sp/>val<sp/>=<sp/><ref refid="stage_8c_1a03ebd25f6254d11bc790e70e9aabd9eb" kindref="member">FTI_GetStatusField</ref>(<sp/>FTI_Exec,<sp/>FTI_Topo,<sp/>ID,<sp/><ref refid="stage_8h_1a90a1c70f104f770eff8ba0b2febc7887a18a6215a6b91702735bbfb1f211d814c" kindref="member">FTI_SIF_VAL</ref>,<sp/>source<sp/>);</highlight></codeline>
<codeline lineno="1279"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>valstr[<ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>];</highlight></codeline>
<codeline lineno="1280"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(<sp/>val<sp/>)<sp/>{</highlight></codeline>
<codeline lineno="1281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a26fc9f53bb9fcbbf144da0488e217172" kindref="member">FTI_SI_NINI</ref>:</highlight></codeline>
<codeline lineno="1282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(<sp/>valstr,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>,<sp/></highlight><highlight class="stringliteral">&quot;not<sp/>initialized&quot;</highlight><highlight class="normal"><sp/>);</highlight></codeline>
<codeline lineno="1283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a8b63f0cd5d9aa9417c3d3ec5a703ca1b" kindref="member">FTI_SI_FAIL</ref>:</highlight></codeline>
<codeline lineno="1285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(<sp/>valstr,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>,<sp/></highlight><highlight class="stringliteral">&quot;failure&quot;</highlight><highlight class="normal"><sp/>);</highlight></codeline>
<codeline lineno="1286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1287"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a93cefc8dced9cb5c63c45708ef89694b" kindref="member">FTI_SI_SCES</ref>:<sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(<sp/>valstr,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>,<sp/></highlight><highlight class="stringliteral">&quot;success&quot;</highlight><highlight class="normal"><sp/>);</highlight></codeline>
<codeline lineno="1289"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1290"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a1685329d73a38dd15caa9a9b5ffef36f" kindref="member">FTI_SI_ACTV</ref>:</highlight></codeline>
<codeline lineno="1291"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(<sp/>valstr,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>,<sp/></highlight><highlight class="stringliteral">&quot;active&quot;</highlight><highlight class="normal"><sp/>);</highlight></codeline>
<codeline lineno="1292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1293"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="fti_8h_1a4eb6ff54cf8f3c3149d42da30d23c498" kindref="member">FTI_SI_PEND</ref>:</highlight></codeline>
<codeline lineno="1294"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(<sp/>valstr,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>,<sp/></highlight><highlight class="stringliteral">&quot;pending&quot;</highlight><highlight class="normal"><sp/>);</highlight></codeline>
<codeline lineno="1295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1296"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1297"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(<sp/>valstr,<sp/><ref refid="fti_8h_1a4da53a2ca9ef19b414ca7e2522c4864a" kindref="member">FTI_BUFS</ref>,<sp/></highlight><highlight class="stringliteral">&quot;not<sp/>valid<sp/>(&apos;%d&apos;)&quot;</highlight><highlight class="normal">,<sp/>val<sp/>);</highlight></codeline>
<codeline lineno="1298"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1299"><highlight class="normal"></highlight></codeline>
<codeline lineno="1300"><highlight class="normal"><sp/><sp/><sp/><sp/>printf(</highlight><highlight class="stringliteral">&quot;[rank(g|l):%d|%d][ID:%d]<sp/>status<sp/>is<sp/>&apos;avl:%s&apos;,<sp/>&apos;idx:%s&apos;,<sp/>&apos;val:%s&apos;\n&quot;</highlight><highlight class="normal">,<sp/>FTI_Topo-&gt;<ref refid="structFTIT__topology_1afd9e834e60e98abbce232192a38a7d58" kindref="member">myRank</ref>,<sp/>FTI_Topo-&gt;<ref refid="structFTIT__topology_1a39761a9bc4ad6d0ca46b7ca82593c175" kindref="member">nodeRank</ref>,<sp/>ID,<sp/>avlstr,<sp/>idxstr,<sp/>valstr<sp/>);</highlight></codeline>
<codeline lineno="1301"><highlight class="normal"></highlight></codeline>
<codeline lineno="1302"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1303"><highlight class="normal"></highlight></codeline>
    </programlisting>
    <location file="/home/bscuser/Documents/release/dev/fti/src/stage.c"/>
  </compounddef>
</doxygen>
